{"version":3,"file":"webgpuEngine.js","sourceRoot":"","sources":["../../../sourceES6/core/Engines/webgpuEngine.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from \"../Misc/logger\";\nimport { IsWindowObjectExist } from '../Misc/domManagement';\nimport { Nullable, DataArray, IndicesArray, Immutable } from \"../types\";\nimport { Color4 } from \"../Maths/math\";\nimport { Engine } from \"../Engines/engine\";\nimport { InstancingAttributeInfo } from \"../Engines/instancingAttributeInfo\";\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\nimport { IEffectCreationOptions, Effect } from \"../Materials/effect\";\nimport { EffectFallbacks } from \"../Materials/effectFallbacks\";\nimport { _TimeToken } from \"../Instrumentation/timeToken\";\n\nimport * as WebGPUConstants from './WebGPU/webgpuConstants';\nimport { VertexBuffer } from \"../Buffers/buffer\";\nimport { WebGPUPipelineContext, IWebGPURenderPipelineStageDescriptor } from './WebGPU/webgpuPipelineContext';\nimport { IPipelineContext } from './IPipelineContext';\nimport { DataBuffer } from '../Buffers/dataBuffer';\nimport { BaseTexture } from \"../Materials/Textures/baseTexture\";\nimport { IShaderProcessor } from \"./Processors/iShaderProcessor\";\nimport { WebGPUShaderProcessorGLSL } from \"./WebGPU/webgpuShaderProcessorsGLSL\";\nimport { WebGPUShaderProcessorWGSL } from \"./WebGPU/webgpuShaderProcessorsWGSL\";\nimport { ShaderProcessingContext } from \"./Processors/shaderProcessingOptions\";\nimport { WebGPUShaderProcessingContext } from \"./WebGPU/webgpuShaderProcessingContext\";\nimport { Tools } from \"../Misc/tools\";\nimport { WebGPUTextureHelper } from './WebGPU/webgpuTextureHelper';\nimport { ISceneLike } from './thinEngine';\nimport { WebGPUBufferManager } from './WebGPU/webgpuBufferManager';\nimport { HardwareTextureWrapper } from '../Materials/Textures/hardwareTextureWrapper';\nimport { WebGPUHardwareTexture } from './WebGPU/webgpuHardwareTexture';\nimport { IColor4Like } from '../Maths/math.like';\nimport { UniformBuffer } from '../Materials/uniformBuffer';\nimport { WebGPURenderPassWrapper } from './WebGPU/webgpuRenderPassWrapper';\nimport { WebGPUCacheSampler } from \"./WebGPU/webgpuCacheSampler\";\nimport { WebGPUCacheRenderPipeline } from \"./WebGPU/webgpuCacheRenderPipeline\";\nimport { WebGPUCacheRenderPipelineTree } from \"./WebGPU/webgpuCacheRenderPipelineTree\";\nimport { WebGPUStencilStateComposer } from \"./WebGPU/webgpuStencilStateComposer\";\nimport { WebGPUDepthCullingState } from \"./WebGPU/webgpuDepthCullingState\";\nimport { DrawWrapper } from \"../Materials/drawWrapper\";\nimport { WebGPUMaterialContext } from \"./WebGPU/webgpuMaterialContext\";\nimport { WebGPUDrawContext } from \"./WebGPU/webgpuDrawContext\";\nimport { WebGPUCacheBindGroups } from \"./WebGPU/webgpuCacheBindGroups\";\nimport { WebGPUClearQuad } from \"./WebGPU/webgpuClearQuad\";\nimport { IStencilState } from \"../States/IStencilState\";\nimport { WebGPURenderItemBlendColor, WebGPURenderItemScissor, WebGPURenderItemStencilRef, WebGPURenderItemViewport, WebGPUBundleList } from \"./WebGPU/webgpuBundleList\";\nimport { WebGPUTimestampQuery } from \"./WebGPU/webgpuTimestampQuery\";\nimport { ComputeEffect } from \"../Compute/computeEffect\";\nimport { WebGPUOcclusionQuery } from \"./WebGPU/webgpuOcclusionQuery\";\nimport { Observable } from \"../Misc/observable\";\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner\";\nimport { TwgslOptions, WebGPUTintWASM } from \"./WebGPU/webgpuTintWASM\";\nimport { ExternalTexture } from \"../Materials/Textures/externalTexture\";\nimport { WebGPUShaderProcessor } from \"./WebGPU/webgpuShaderProcessor\";\nimport { ShaderLanguage } from \"../Materials/shaderLanguage\";\nimport { InternalTextureCreationOptions, TextureSize } from \"../Materials/Textures/textureCreationOptions\";\nimport { WebGPUSnapshotRendering } from \"./WebGPU/webgpuSnapshotRendering\";\n\ndeclare function importScripts(...urls: string[]): void;\n\ndeclare type VideoTexture = import(\"../Materials/Textures/videoTexture\").VideoTexture;\ndeclare type RenderTargetTexture = import(\"../Materials/Textures/renderTargetTexture\").RenderTargetTexture;\ndeclare type RenderTargetWrapper = import(\"./renderTargetWrapper\").RenderTargetWrapper;\n\n/**\n * Options to load the associated Glslang library\n */\nexport interface GlslangOptions {\n    /**\n     * Defines an existing instance of Glslang (useful in modules who do not access the global instance).\n     */\n    glslang?: any;\n    /**\n     * Defines the URL of the glslang JS File.\n     */\n    jsPath?: string;\n    /**\n     * Defines the URL of the glslang WASM File.\n     */\n    wasmPath?: string;\n}\n\n/**\n * Options to create the WebGPU engine\n */\nexport interface WebGPUEngineOptions extends GPURequestAdapterOptions {\n\n    /**\n     * If delta time between frames should be constant\n     * @see https://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\n     */\n    deterministicLockstep?: boolean;\n\n    /**\n     * Maximum about of steps between frames (Default: 4)\n     * @see https://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\n     */\n    lockstepMaxSteps?: number;\n\n    /**\n     * Defines the seconds between each deterministic lock step\n     */\n    timeStep?: number;\n\n    /**\n     * Defines that engine should ignore context lost events\n     * If this event happens when this parameter is true, you will have to reload the page to restore rendering\n     */\n    doNotHandleContextLost?: boolean;\n\n    /**\n     * Defines that engine should ignore modifying touch action attribute and style\n     * If not handle, you might need to set it up on your side for expected touch devices behavior.\n     */\n    doNotHandleTouchAction?: boolean;\n\n    /**\n     * Defines if webaudio should be initialized as well\n     * @see http://doc.babylonjs.com/how_to/playing_sounds_and_music\n     */\n    audioEngine?: boolean;\n\n    /**\n     * Defines the category of adapter to use.\n     * Is it the discrete or integrated device.\n     */\n    powerPreference?: GPUPowerPreference;\n\n    /**\n     * Defines the device descriptor used to create a device.\n     */\n    deviceDescriptor?: GPUDeviceDescriptor;\n\n    /**\n     * Defines the requested Swap Chain Format.\n     */\n    swapChainFormat?: GPUTextureFormat;\n\n    /**\n     * Defines whether MSAA is enabled on the canvas.\n     */\n    antialiasing?: boolean;\n\n    /**\n     * Defines whether the stencil buffer should be enabled.\n     */\n    stencil?: boolean;\n\n    /**\n     * Defines whether we should generate debug markers in the gpu command lists (can be seen with PIX for eg)\n     */\n    enableGPUDebugMarkers?: boolean;\n\n    /**\n     * Options to load the associated Glslang library\n     */\n    glslangOptions?: GlslangOptions;\n\n    /**\n     * Options to load the associated Twgsl library\n     */\n    twgslOptions?: TwgslOptions;\n\n     /**\n     * Defines if the engine should no exceed a specified device ratio\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\n     */\n    limitDeviceRatio?: number;\n\n    /**\n     * Defines whether to adapt to the device's viewport characteristics (default: false)\n     */\n    adaptToDeviceRatio?: boolean;\n\n    /**\n     * Defines whether the canvas should be created in \"premultiplied\" mode (if false, the canvas is created in the \"opaque\" mode) (true by default)\n     */\n    premultipliedAlpha?: boolean;\n\n    /**\n     * Defines if the final framebuffer Y inversion should always be done by a texture copy (default: false).\n     * If false (and if not using an offscreen canvas), the inversion will be done by the browser during compositing\n     */\n    forceCopyForInvertYFinalFramebuffer?: boolean;\n\n    /**\n     * Defines if the final copy pass doing the Y inversion should be disabled (default: false). This setting takes precedence over forceCopyForInvertYFinalFramebuffer.\n     * If true and if using an offscreen canvas, you should set something like canvas.style.transform = \"scaleY(-1)\" on the canvas from which you get the offscreen canvas, else the rendering will be Y inverted!\n     * Setting it to true allows to use the browser compositing to perform the Y inversion even when using an offscreen canvas, which leads to better performances\n     */\n    disableCopyForInvertYFinalFramebuffer?: boolean;\n}\n\n/**\n * The web GPU engine class provides support for WebGPU version of babylon.js.\n * @since 5.0.0\n */\nexport class WebGPUEngine extends Engine {\n    // Default glslang options.\n    private static readonly _glslangDefaultOptions: GlslangOptions = {\n        jsPath: \"https://preview.babylonjs.com/glslang/glslang.js\",\n        wasmPath: \"https://preview.babylonjs.com/glslang/glslang.wasm\"\n    };\n\n    /** true to enable using TintWASM to convert Spir-V to WGSL */\n    public static UseTWGSL = true;\n\n    // Page Life cycle and constants\n    private readonly _uploadEncoderDescriptor = { label: \"upload\" };\n    private readonly _renderEncoderDescriptor = { label: \"render\" };\n    private readonly _renderTargetEncoderDescriptor = { label: \"renderTarget\" };\n    /** @hidden */\n    public readonly _clearDepthValue = 1;\n    /** @hidden */\n    public readonly _clearReverseDepthValue = 0;\n    /** @hidden */\n    public readonly _clearStencilValue = 0;\n    private readonly _defaultSampleCount = 4; // Only supported value for now.\n\n    // Engine Life Cycle\n    private _canvas: HTMLCanvasElement;\n    /** @hidden */\n    public _options: WebGPUEngineOptions;\n    private _glslang: any = null;\n    private _tintWASM: Nullable<WebGPUTintWASM> = null;\n    private _adapter: GPUAdapter;\n    private _adapterSupportedExtensions: GPUFeatureName[];\n    /** @hidden */\n    public _device: GPUDevice;\n    private _deviceEnabledExtensions: GPUFeatureName[];\n    private _context: GPUCanvasContext;\n    private _swapChainTexture: GPUTexture;\n    private _mainPassSampleCount: number;\n    /** @hidden */\n    public _textureHelper: WebGPUTextureHelper;\n    /** @hidden */\n    public _bufferManager: WebGPUBufferManager;\n    private _clearQuad: WebGPUClearQuad;\n    /** @hidden */\n    public _cacheSampler: WebGPUCacheSampler;\n    /** @hidden */\n    public _cacheRenderPipeline: WebGPUCacheRenderPipeline;\n    private _cacheBindGroups: WebGPUCacheBindGroups;\n    private _emptyVertexBuffer: VertexBuffer;\n    /** @hidden */\n    public _mrtAttachments: number[];\n    /** @hidden */\n    public _timestampQuery: WebGPUTimestampQuery;\n    /** @hidden */\n    public _occlusionQuery: WebGPUOcclusionQuery;\n    /** @hidden */\n    public _compiledComputeEffects: { [key: string]: ComputeEffect } = {};\n    /** @hidden */\n    public _counters: {\n        numEnableEffects: number;\n        numEnableDrawWrapper: number;\n        numBundleCreationNonCompatMode: number;\n        numBundleReuseNonCompatMode: number;\n    } = {\n            numEnableEffects: 0,\n            numEnableDrawWrapper: 0,\n            numBundleCreationNonCompatMode: 0,\n            numBundleReuseNonCompatMode: 0,\n        };\n    /**\n     * Counters from last frame\n     */\n    public readonly countersLastFrame: {\n        numEnableEffects: number;\n        numEnableDrawWrapper: number;\n        numBundleCreationNonCompatMode: number;\n        numBundleReuseNonCompatMode: number;\n    } = {\n            numEnableEffects: 0,\n            numEnableDrawWrapper: 0,\n            numBundleCreationNonCompatMode: 0,\n            numBundleReuseNonCompatMode: 0,\n        };\n    /**\n     * Max number of uncaptured error messages to log\n     */\n    public numMaxUncapturedErrors = 20;\n\n    private _invertYFinalFramebuffer: boolean;\n\n    // Some of the internal state might change during the render pass.\n    // This happens mainly during clear for the state\n    // And when the frame starts to swap the target texture from the swap chain\n    private _mainTexture: GPUTexture;\n    private _mainTextureLastCopy: GPUTexture;\n    private _depthTexture: GPUTexture;\n    private _mainTextureExtends: GPUExtent3D;\n    private _depthTextureFormat: GPUTextureFormat | undefined;\n    private _colorFormat: GPUTextureFormat;\n\n    // Frame Life Cycle (recreated each frame)\n    /** @hidden */\n    public _uploadEncoder: GPUCommandEncoder;\n    /** @hidden */\n    public _renderEncoder: GPUCommandEncoder;\n    /** @hidden */\n    public _renderTargetEncoder: GPUCommandEncoder;\n\n    private _commandBuffers: GPUCommandBuffer[] = [null as any, null as any, null as any];\n\n    // Frame Buffer Life Cycle (recreated for each render target pass)\n    /** @hidden */\n    public _currentRenderPass: Nullable<GPURenderPassEncoder> = null;\n    /** @hidden */\n    public _mainRenderPassWrapper: WebGPURenderPassWrapper = new WebGPURenderPassWrapper();\n    private _mainRenderPassCopyWrapper: WebGPURenderPassWrapper = new WebGPURenderPassWrapper();\n    /** @hidden */\n    public _rttRenderPassWrapper: WebGPURenderPassWrapper = new WebGPURenderPassWrapper();\n    /** @hidden */\n    public _pendingDebugCommands: Array<[string, Nullable<string>]> = [];\n    /** @hidden */\n    public _bundleList: WebGPUBundleList;\n    /** @hidden */\n    public _bundleListRenderTarget: WebGPUBundleList;\n    /** @hidden */\n    public _onAfterUnbindFrameBufferObservable = new Observable<WebGPUEngine>();\n\n    // DrawCall Life Cycle\n    // Effect is on the parent class\n    // protected _currentEffect: Nullable<Effect> = null;\n    private _defaultDrawContext: WebGPUDrawContext;\n    private _defaultMaterialContext: WebGPUMaterialContext;\n    /** @hidden */\n    public _currentDrawContext: WebGPUDrawContext;\n    /** @hidden */\n    public _currentMaterialContext: WebGPUMaterialContext;\n    private _currentOverrideVertexBuffers: Nullable<{ [key: string]: Nullable<VertexBuffer> }> = null;\n    private _currentIndexBuffer: Nullable<DataBuffer> = null;\n    private __colorWrite = true;\n    private _forceEnableEffect = false;\n\n    // TODO WEBGPU remove those variables when code stabilized\n    /** @hidden */\n    public dbgShowShaderCode = false;\n    /** @hidden */\n    public dbgSanityChecks = true;\n    /** @hidden */\n    public dbgVerboseLogsForFirstFrames = false;\n    /** @hidden */\n    public dbgVerboseLogsNumFrames = 10;\n    /** @hidden */\n    public dbgLogIfNotDrawWrapper = true;\n    /** @hidden */\n    public dbgShowEmptyEnableEffectCalls = true;\n\n    private _snapshotRendering: WebGPUSnapshotRendering;\n\n    /**\n     * Gets or sets the snapshot rendering mode\n     */\n    public get snapshotRenderingMode(): number {\n        return this._snapshotRendering.mode;\n    }\n\n    public set snapshotRenderingMode(mode: number) {\n        this._snapshotRendering.mode = mode;\n    }\n\n    /**\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\n     */\n    public snapshotRenderingReset(): void {\n        this._snapshotRendering.reset();\n    }\n\n    /**\n     * Enables or disables the snapshot rendering mode\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\n     */\n    public get snapshotRendering(): boolean {\n        return this._snapshotRendering.enabled;\n    }\n\n    public set snapshotRendering(activate) {\n        this._snapshotRendering.enabled = activate;\n    }\n\n    /**\n     * Sets this to true to disable the cache for the samplers. You should do it only for testing purpose!\n     */\n    public get disableCacheSamplers(): boolean {\n        return this._cacheSampler ? this._cacheSampler.disabled : false;\n    }\n\n    public set disableCacheSamplers(disable: boolean) {\n        if (this._cacheSampler) {\n            this._cacheSampler.disabled = disable;\n        }\n    }\n\n    /**\n     * Sets this to true to disable the cache for the render pipelines. You should do it only for testing purpose!\n     */\n    public get disableCacheRenderPipelines(): boolean {\n        return this._cacheRenderPipeline ? this._cacheRenderPipeline.disabled : false;\n    }\n\n    public set disableCacheRenderPipelines(disable: boolean) {\n        if (this._cacheRenderPipeline) {\n            this._cacheRenderPipeline.disabled = disable;\n        }\n    }\n\n    /**\n     * Sets this to true to disable the cache for the bind groups. You should do it only for testing purpose!\n     */\n    public get disableCacheBindGroups(): boolean {\n        return this._cacheBindGroups ? this._cacheBindGroups.disabled : false;\n    }\n\n    public set disableCacheBindGroups(disable: boolean) {\n        if (this._cacheBindGroups) {\n            this._cacheBindGroups.disabled = disable;\n        }\n    }\n\n    /**\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a WebGPU context can be found)\n     */\n     public static get IsSupportedAsync(): Promise<boolean> {\n        return !navigator.gpu ? Promise.resolve(false) : navigator.gpu.requestAdapter().then((adapter: GPUAdapter | null) => !!adapter, (rejected) => false).catch((e) => false);\n    }\n\n    /**\n     * Not supported by WebGPU, you should call IsSupportedAsync instead!\n     */\n    public static get IsSupported(): boolean {\n        Logger.Warn(\"You must call IsSupportedAsync for WebGPU!\");\n        return false;\n    }\n\n    /**\n     * Gets a boolean indicating that the engine supports uniform buffers\n     */\n    public get supportsUniformBuffers(): boolean {\n        return true;\n    }\n\n    /** Gets the supported extensions by the WebGPU adapter */\n    public get supportedExtensions(): Immutable<GPUFeatureName[]> {\n        return this._adapterSupportedExtensions;\n    }\n\n    /** Gets the currently enabled extensions on the WebGPU device */\n    public get enabledExtensions(): Immutable<GPUFeatureName[]> {\n        return this._deviceEnabledExtensions;\n    }\n\n    /**\n     * Returns the name of the engine\n     */\n    public get name(): string {\n        return \"WebGPU\";\n    }\n\n    /**\n     * Returns a string describing the current engine\n     */\n    public get description(): string {\n        let description = this.name + this.version;\n\n        return description;\n    }\n\n    /**\n     * Returns the version of the engine\n     */\n    public get version(): number {\n        return 1;\n    }\n\n    /**\n     * Gets an object containing information about the current engine context\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\n     */\n    public getInfo() {\n        return {\n            vendor: \"unknown vendor\",\n            renderer: \"unknown renderer\",\n            version: \"unknown version\",\n        };\n    }\n\n    /**\n     * (WebGPU only) True (default) to be in compatibility mode, meaning rendering all existing scenes without artifacts (same rendering than WebGL).\n     * Setting the property to false will improve performances but may not work in some scenes if some precautions are not taken.\n     * See @TODO WEBGPU DOC PAGE for more details\n     */\n    public get compatibilityMode() {\n        return this._compatibilityMode;\n    }\n\n    public set compatibilityMode(mode: boolean) {\n        this._compatibilityMode = mode;\n    }\n\n    /** @hidden */\n    public get currentSampleCount(): number {\n        return this._currentRenderTarget ? this._currentRenderTarget.samples : this._mainPassSampleCount;\n    }\n\n    /**\n     * Create a new instance of the gpu engine asynchronously\n     * @param canvas Defines the canvas to use to display the result\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\n     * @returns a promise that resolves with the created engine\n     */\n    public static CreateAsync(canvas: HTMLCanvasElement, options: WebGPUEngineOptions = {}): Promise<WebGPUEngine> {\n        const engine = new WebGPUEngine(canvas, options);\n\n        return new Promise((resolve) => {\n            engine.initAsync(options.glslangOptions, options.twgslOptions).then(() => resolve(engine));\n        });\n    }\n\n    /**\n     * Create a new instance of the gpu engine.\n     * @param canvas Defines the canvas to use to display the result\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\n     */\n    public constructor(canvas: HTMLCanvasElement, options: WebGPUEngineOptions = {}) {\n        super(null);\n\n        (this.isNDCHalfZRange as any) = true;\n        (this.hasOriginBottomLeft as any)  = false;\n\n        options.deviceDescriptor = options.deviceDescriptor || {};\n        options.swapChainFormat = options.swapChainFormat || WebGPUConstants.TextureFormat.BGRA8Unorm;\n        options.antialiasing = options.antialiasing === undefined ? true : options.antialiasing;\n        options.stencil = options.stencil ?? true;\n        options.enableGPUDebugMarkers = options.enableGPUDebugMarkers ?? false;\n\n        Logger.Log(`Babylon.js v${Engine.Version} - ${this.description} engine`);\n        if (!navigator.gpu) {\n            Logger.Error(\"WebGPU is not supported by your browser.\");\n            return;\n        }\n\n        this._isWebGPU = true;\n        this._shaderPlatformName = \"WEBGPU\";\n\n        if (options.deterministicLockstep === undefined) {\n            options.deterministicLockstep = false;\n        }\n\n        if (options.lockstepMaxSteps === undefined) {\n            options.lockstepMaxSteps = 4;\n        }\n\n        if (options.audioEngine === undefined) {\n            options.audioEngine = true;\n        }\n\n        this._deterministicLockstep = options.deterministicLockstep;\n        this._lockstepMaxSteps = options.lockstepMaxSteps;\n        this._timeStep = options.timeStep || 1 / 60;\n\n        this._doNotHandleContextLost = !!options.doNotHandleContextLost;\n\n        this._canvas = canvas;\n        this._options = options;\n        this.premultipliedAlpha = options.premultipliedAlpha ?? true;\n\n        const devicePixelRatio = IsWindowObjectExist() ? (window.devicePixelRatio || 1.0) : 1.0;\n        const limitDeviceRatio = options.limitDeviceRatio || devicePixelRatio;\n        const adaptToDeviceRatio = options.adaptToDeviceRatio ?? false;\n\n        this._hardwareScalingLevel = adaptToDeviceRatio ? 1.0 / Math.min(limitDeviceRatio, devicePixelRatio) : 1.0;\n        this._mainPassSampleCount = options.antialiasing ? this._defaultSampleCount : 1;\n        this._isStencilEnable = options.stencil;\n\n        this._sharedInit(canvas, !!options.doNotHandleTouchAction, options.audioEngine);\n\n        this._shaderProcessor = new WebGPUShaderProcessorGLSL();\n        this._shaderProcessorWGSL = new WebGPUShaderProcessorWGSL();\n\n        this._invertYFinalFramebuffer = (!!this._options.forceCopyForInvertYFinalFramebuffer || !this._canvas.style) && !this._options.disableCopyForInvertYFinalFramebuffer;\n        if (!this._invertYFinalFramebuffer) {\n            // if style does not exist, we are probably using an offscreen canvas\n            if (this._canvas.style) {\n                this._canvas.style.transform = \"scaleY(-1)\";\n            }\n        }\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Initialization\n    //------------------------------------------------------------------------------\n\n    /**\n     * Initializes the WebGPU context and dependencies.\n     * @param glslangOptions Defines the GLSLang compiler options if necessary\n     * @param twgslOptions Defines the Twgsl compiler options if necessary\n     * @returns a promise notifying the readiness of the engine.\n     */\n    public initAsync(glslangOptions?: GlslangOptions, twgslOptions?: TwgslOptions): Promise<void> {\n        return this._initGlslang(glslangOptions ?? this._options?.glslangOptions)\n            .then((glslang: any) => {\n                this._glslang = glslang;\n                this._tintWASM = WebGPUEngine.UseTWGSL ? new WebGPUTintWASM() : null;\n                return this._tintWASM ?\n                    this._tintWASM.initTwgsl(twgslOptions ?? this._options?.twgslOptions)\n                        .then(() => {\n                            return navigator.gpu!.requestAdapter(this._options);\n                        }, (msg: string) => {\n                            Logger.Error(\"Can not initialize twgsl!\");\n                            Logger.Error(msg);\n                            throw Error(\"WebGPU initializations stopped.\");\n                        })\n                    : navigator.gpu!.requestAdapter(this._options);\n            }, (msg: string) => {\n                Logger.Error(\"Can not initialize glslang!\");\n                Logger.Error(msg);\n                throw Error(\"WebGPU initializations stopped.\");\n            })\n            .then((adapter: GPUAdapter | null) => {\n                if (!adapter) {\n                    throw \"Could not retrieve a WebGPU adapter (adapter is null).\";\n                } else {\n                    this._adapter = adapter!;\n                    this._adapterSupportedExtensions = [];\n                    this._adapter.features?.forEach((feature) => this._adapterSupportedExtensions.push(feature as WebGPUConstants.FeatureName));\n\n                    const deviceDescriptor = this._options.deviceDescriptor;\n\n                    if (deviceDescriptor?.requiredFeatures) {\n                        const requestedExtensions = deviceDescriptor.requiredFeatures;\n                        const validExtensions: GPUFeatureName[] = [];\n\n                        for (let extension of requestedExtensions) {\n                            if (this._adapterSupportedExtensions.indexOf(extension) !== -1) {\n                                validExtensions.push(extension);\n                            }\n                        }\n\n                        deviceDescriptor.requiredFeatures = validExtensions;\n                    }\n\n                    return this._adapter.requestDevice(this._options.deviceDescriptor);\n                }\n            })\n            .then((device: GPUDevice) => {\n                this._device = device;\n                this._deviceEnabledExtensions = [];\n                this._device.features?.forEach((feature) => this._deviceEnabledExtensions.push(feature as WebGPUConstants.FeatureName));\n\n                let numUncapturedErrors = -1;\n                this._device.addEventListener('uncapturederror', (event) => {\n                    if (++numUncapturedErrors < this.numMaxUncapturedErrors) {\n                        Logger.Warn(`WebGPU uncaptured error (${numUncapturedErrors + 1}): ${(<GPUUncapturedErrorEvent>event).error} - ${(<any>event).error.message}`);\n                    } else if (numUncapturedErrors++ === this.numMaxUncapturedErrors) {\n                        Logger.Warn(`WebGPU uncaptured error: too many warnings (${this.numMaxUncapturedErrors}), no more warnings will be reported to the console for this engine.`);\n                    }\n                });\n\n                if (!this._doNotHandleContextLost) {\n                    this._device.lost?.then((info) => {\n                        this._contextWasLost = true;\n                        Logger.Warn(\"WebGPU context lost. \" + info);\n                        this.onContextLostObservable.notifyObservers(this);\n                        this._restoreEngineAfterContextLost(this.initAsync.bind(this));\n                    });\n                }\n            }, (e: any) => {\n                Logger.Error(\"Could not retrieve a WebGPU device.\");\n                Logger.Error(e);\n            })\n            .then(() => {\n                this._bufferManager = new WebGPUBufferManager(this._device);\n                this._textureHelper = new WebGPUTextureHelper(this._device, this._glslang, this._tintWASM, this._bufferManager);\n                this._cacheSampler = new WebGPUCacheSampler(this._device);\n                this._cacheBindGroups = new WebGPUCacheBindGroups(this._device, this._cacheSampler, this);\n                this._timestampQuery = new WebGPUTimestampQuery(this._device, this._bufferManager);\n                this._occlusionQuery = (this._device as any).createQuerySet ? new WebGPUOcclusionQuery(this, this._device, this._bufferManager) : undefined as any;\n                this._bundleList = new WebGPUBundleList(this._device);\n                this._bundleListRenderTarget = new WebGPUBundleList(this._device);\n                this._snapshotRendering = new WebGPUSnapshotRendering(this, this._snapshotRenderingMode, this._bundleList, this._bundleListRenderTarget);\n\n                if (this.dbgVerboseLogsForFirstFrames) {\n                    if ((this as any)._count === undefined) {\n                        (this as any)._count = 0;\n                        console.log(\"%c frame #\" + (this as any)._count + \" - begin\", \"background: #ffff00\");\n                    }\n                }\n\n                this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\n                this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\n                this._renderTargetEncoder = this._device.createCommandEncoder(this._renderTargetEncoderDescriptor);\n\n                this._emptyVertexBuffer = new VertexBuffer(this, [0], \"\", false, false, 1, false, 0, 1);\n\n                this._initializeLimits();\n\n                this._cacheRenderPipeline = new WebGPUCacheRenderPipelineTree(this._device, this._emptyVertexBuffer, !this._caps.textureFloatLinearFiltering);\n\n                this._depthCullingState = new WebGPUDepthCullingState(this._cacheRenderPipeline);\n                this._stencilStateComposer = new WebGPUStencilStateComposer(this._cacheRenderPipeline);\n                this._stencilStateComposer.stencilGlobal = this._stencilState;\n\n                this._depthCullingState.depthTest = true;\n                this._depthCullingState.depthFunc = 515;\n                this._depthCullingState.depthMask = true;\n\n                this._textureHelper.setCommandEncoder(this._uploadEncoder);\n\n                this._clearQuad = new WebGPUClearQuad(this._device, this, this._emptyVertexBuffer);\n                this._defaultDrawContext = this.createDrawContext()!;\n                this._currentDrawContext = this._defaultDrawContext;\n                this._defaultMaterialContext = this.createMaterialContext()!;\n                this._currentMaterialContext = this._defaultMaterialContext;\n\n                this._initializeContextAndSwapChain();\n                this._initializeMainAttachments();\n                this.resize();\n            })\n            .catch((e: any) => {\n                Logger.Error(\"Can not create WebGPU Device and/or context.\");\n                Logger.Error(e);\n                if (console.trace) {\n                    console.trace();\n                }\n            });\n    }\n\n    private _initGlslang(glslangOptions?: GlslangOptions): Promise<any> {\n        glslangOptions = glslangOptions || {};\n        glslangOptions = {\n            ...WebGPUEngine._glslangDefaultOptions,\n            ...glslangOptions\n        };\n\n        if (glslangOptions.glslang) {\n            return Promise.resolve(glslangOptions.glslang);\n        }\n\n        if ((self as any).glslang) {\n            return (self as any).glslang(glslangOptions!.wasmPath);\n        }\n\n        if (glslangOptions.jsPath && glslangOptions.wasmPath) {\n            if (IsWindowObjectExist()) {\n                return Tools.LoadScriptAsync(glslangOptions.jsPath)\n                    .then(() => {\n                        return (self as any).glslang(glslangOptions!.wasmPath);\n                    });\n            } else {\n                importScripts(glslangOptions.jsPath);\n                return (self as any).glslang(glslangOptions!.wasmPath);\n            }\n        }\n\n        return Promise.reject(\"gslang is not available.\");\n    }\n\n    private _initializeLimits(): void {\n        // Init caps\n        // TODO WEBGPU Real Capability check once limits will be working.\n\n        this._caps = {\n            maxTexturesImageUnits: 16,\n            maxVertexTextureImageUnits: 16,\n            maxCombinedTexturesImageUnits: 32,\n            maxTextureSize: 8192,\n            maxCubemapTextureSize: 2048,\n            maxRenderTextureSize: 8192,\n            maxVertexAttribs: 16,\n            maxVaryingVectors: 15,\n            maxFragmentUniformVectors: 1024,\n            maxVertexUniformVectors: 1024,\n            standardDerivatives: true,\n            astc: null,\n            s3tc: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionBC) >= 0 ? true : undefined) as any,\n            pvrtc: null,\n            etc1: null,\n            etc2: null,\n            bptc: this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionBC) >= 0 ? true : undefined,\n            maxAnisotropy: 4, // the spec only supports values of 1 and 4\n            uintIndices: true,\n            fragmentDepthSupported: true,\n            highPrecisionShaderSupported: true,\n            colorBufferFloat: true,\n            textureFloat: true,\n            textureFloatLinearFiltering: false, // WebGPU does not allow filtering 32 bits float textures\n            textureFloatRender: true,\n            textureHalfFloat: true,\n            textureHalfFloatLinearFiltering: true,\n            textureHalfFloatRender: true,\n            textureLOD: true,\n            drawBuffersExtension: true,\n            depthTextureExtension: true,\n            vertexArrayObject: false,\n            instancedArrays: true,\n            timerQuery: typeof (BigUint64Array) !== \"undefined\" && this.enabledExtensions.indexOf(WebGPUConstants.FeatureName.TimestampQuery) !== -1 ? true as any : undefined,\n            supportOcclusionQuery: typeof (BigUint64Array) !== \"undefined\",\n            canUseTimestampForTimerQuery: true,\n            multiview: false,\n            oculusMultiview: false,\n            parallelShaderCompile: undefined,\n            blendMinMax: true,\n            maxMSAASamples: 4,\n            canUseGLInstanceID: true,\n            canUseGLVertexID: true,\n            supportComputeShaders: true,\n            supportSRGBBuffers: true,\n        };\n\n        this._caps.parallelShaderCompile = null as any;\n\n        this._features = {\n            forceBitmapOverHTMLImageElement: true,\n            supportRenderAndCopyToLodForFloatTextures: true,\n            supportDepthStencilTexture: true,\n            supportShadowSamplers: true,\n            uniformBufferHardCheckMatrix: false,\n            allowTexturePrefiltering: true,\n            trackUbosInFrame: true,\n            checkUbosContentBeforeUpload: true,\n            supportCSM: true,\n            basisNeedsPOT: false,\n            support3DTextures: true,\n            needTypeSuffixInShaderConstants: true,\n            supportMSAA: true,\n            supportSSAO2: true,\n            supportExtendedTextureFormats: true,\n            supportSwitchCaseInShader: true,\n            supportSyncTextureRead: false,\n            needsInvertingBitmap: false,\n            useUBOBindingCache: false,\n            needShaderCodeInlining: true,\n            needToAlwaysBindUniformBuffers: true,\n            supportRenderPasses: true,\n            _collectUbosUpdatedInFrame: false,\n        };\n    }\n\n    private _initializeContextAndSwapChain(): void {\n        this._context = this._canvas.getContext('webgpu') as unknown as GPUCanvasContext;\n        this._configureContext(this._canvas.width, this._canvas.height);\n        this._colorFormat = this._options.swapChainFormat!;\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures = [new WebGPUHardwareTexture()];\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format = this._colorFormat;\n        if (this._invertYFinalFramebuffer) {\n            this._mainRenderPassCopyWrapper.colorAttachmentGPUTextures = [new WebGPUHardwareTexture()];\n            this._mainRenderPassCopyWrapper.colorAttachmentGPUTextures[0].format = this._colorFormat;\n        }\n    }\n\n    // Set default values as WebGL with depth and stencil attachment for the broadest Compat.\n    private _initializeMainAttachments(): void {\n        this._mainTextureExtends = {\n            width: this.getRenderWidth(),\n            height: this.getRenderHeight(),\n            depthOrArrayLayers: 1\n        };\n\n        let mainColorAttachments: GPURenderPassColorAttachment[];\n\n        if (this._options.antialiasing) {\n            const mainTextureDescriptor: GPUTextureDescriptor = {\n                size: this._mainTextureExtends,\n                mipLevelCount: 1,\n                sampleCount: this._mainPassSampleCount,\n                dimension: WebGPUConstants.TextureDimension.E2d,\n                format: this._options.swapChainFormat!,\n                usage: WebGPUConstants.TextureUsage.RenderAttachment,\n            };\n\n            this._mainTexture?.destroy();\n            this._mainTexture = this._device.createTexture(mainTextureDescriptor);\n            mainColorAttachments = [{\n                view: this._mainTexture.createView(),\n                loadValue: new Color4(0, 0, 0, 1),\n                storeOp: WebGPUConstants.StoreOp.Store // don't use StoreOp.Clear, else using several cameras with different viewports or using scissors will fail because we call beginRenderPass / endPass several times for the same color attachment!\n            }];\n        } else {\n            mainColorAttachments = [{\n                view: undefined as any,\n                loadValue: new Color4(0, 0, 0, 1),\n                storeOp: WebGPUConstants.StoreOp.Store\n            }];\n        }\n\n        if (this._invertYFinalFramebuffer) {\n            const mainTextureCopyDescriptor: GPUTextureDescriptor = {\n                size: this._mainTextureExtends,\n                mipLevelCount: 1,\n                sampleCount: 1,\n                dimension: WebGPUConstants.TextureDimension.E2d,\n                format: this._options.swapChainFormat!,\n                usage: WebGPUConstants.TextureUsage.RenderAttachment | WebGPUConstants.TextureUsage.TextureBinding,\n            };\n\n            this._mainTextureLastCopy?.destroy();\n            this._mainTextureLastCopy = this._device.createTexture(mainTextureCopyDescriptor);\n            if (this._options.antialiasing) {\n                mainColorAttachments[0].resolveTarget = this._mainTextureLastCopy.createView();\n            } else {\n                mainColorAttachments[0].view = this._mainTextureLastCopy.createView();\n            }\n            this._mainRenderPassCopyWrapper.renderPassDescriptor = {\n                colorAttachments: [{\n                    view: undefined as any,\n                    loadValue: new Color4(0, 0, 0, 1),\n                    storeOp: WebGPUConstants.StoreOp.Store\n                }]\n            };\n        }\n\n        this._mainRenderPassWrapper.depthTextureFormat = this.isStencilEnable ? WebGPUConstants.TextureFormat.Depth24PlusStencil8 : WebGPUConstants.TextureFormat.Depth32Float;\n\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\n\n        const depthTextureDescriptor: GPUTextureDescriptor = {\n            size: this._mainTextureExtends,\n            mipLevelCount: 1,\n            sampleCount: this._mainPassSampleCount,\n            dimension: WebGPUConstants.TextureDimension.E2d,\n            format: this._mainRenderPassWrapper.depthTextureFormat,\n            usage: WebGPUConstants.TextureUsage.RenderAttachment\n        };\n\n        if (this._depthTexture) {\n            this._depthTexture.destroy();\n        }\n        this._depthTexture = this._device.createTexture(depthTextureDescriptor);\n        const mainDepthAttachment: GPURenderPassDepthStencilAttachment = {\n            view: this._depthTexture.createView(),\n\n            depthLoadValue: this._clearDepthValue,\n            depthStoreOp: WebGPUConstants.StoreOp.Store,\n            stencilLoadValue: this._clearStencilValue,\n            stencilStoreOp: WebGPUConstants.StoreOp.Store,\n        };\n\n        this._mainRenderPassWrapper.renderPassDescriptor = {\n            colorAttachments: mainColorAttachments,\n            depthStencilAttachment: mainDepthAttachment\n        };\n\n        if (this._mainRenderPassWrapper.renderPass !== null) {\n            this._endMainRenderPass();\n        }\n    }\n\n    private _configureContext(width: number, height: number): void {\n        this._context.configure({\n            device: this._device,\n            format: this._options.swapChainFormat!,\n            usage: WebGPUConstants.TextureUsage.RenderAttachment | WebGPUConstants.TextureUsage.CopySrc,\n            compositingAlphaMode: this.premultipliedAlpha ? WebGPUConstants.CanvasCompositingAlphaMode.Premultiplied : WebGPUConstants.CanvasCompositingAlphaMode.Opaque,\n            size: {\n                width,\n                height,\n                depthOrArrayLayers: 1\n            },\n        });\n    }\n\n    /**\n     * Force a specific size of the canvas\n     * @param width defines the new canvas' width\n     * @param height defines the new canvas' height\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\n     * @returns true if the size was changed\n     */\n    public setSize(width: number, height: number, forceSetSize = false): boolean {\n        if (!super.setSize(width, height, forceSetSize)) {\n            return false;\n        }\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - setSize called -\", width, height);\n            }\n        }\n\n        this._configureContext(width, height);\n        this._initializeMainAttachments();\n\n        if (this.snapshotRendering) {\n            // reset snapshot rendering so that the next frame will record a new list of bundles\n            this.snapshotRenderingReset();\n        }\n\n        return true;\n    }\n\n    private _shaderProcessorWGSL: Nullable<IShaderProcessor>;\n\n    /** @hidden */\n    public _getShaderProcessor(shaderLanguage: ShaderLanguage): Nullable<IShaderProcessor> {\n        if (shaderLanguage === ShaderLanguage.WGSL) {\n            return this._shaderProcessorWGSL;\n        }\n        return this._shaderProcessor;\n    }\n\n    /** @hidden */\n    public _getShaderProcessingContext(shaderLanguage: ShaderLanguage): Nullable<ShaderProcessingContext> {\n        return new WebGPUShaderProcessingContext(shaderLanguage);\n    }\n\n    //------------------------------------------------------------------------------\n    //                          Static Pipeline WebGPU States\n    //------------------------------------------------------------------------------\n\n    /** @hidden */\n    public applyStates() {\n        this._stencilStateComposer.apply();\n        this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend);\n    }\n\n    /**\n     * Force the entire cache to be cleared\n     * You should not have to use this function unless your engine needs to share the WebGPU context with another engine\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\n     */\n    public wipeCaches(bruteForce?: boolean): void {\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\n            return;\n        }\n\n        //this._currentEffect = null; // can't reset _currentEffect, else some crashes can occur (for eg in ProceduralTexture which calls bindFrameBuffer (which calls wipeCaches) after having called enableEffect and before drawing into the texture)\n        // _forceEnableEffect = true assumes the role of _currentEffect = null\n        this._forceEnableEffect = true;\n        this._currentIndexBuffer = null;\n        this._currentOverrideVertexBuffers = null;\n        this._cacheRenderPipeline.setBuffers(null, null, null);\n\n        if (bruteForce) {\n            this._stencilStateComposer.reset();\n\n            this._depthCullingState.reset();\n            this._depthCullingState.depthFunc = 515;\n\n            this._alphaState.reset();\n            this._alphaMode = 1;\n            this._alphaEquation = 0;\n            this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters, this._alphaState._blendEquationParameters);\n            this._cacheRenderPipeline.setAlphaBlendEnabled(false);\n\n            this.setColorWrite(true);\n        }\n\n        this._cachedVertexBuffers = null;\n        this._cachedIndexBuffer = null;\n        this._cachedEffectForVertexBuffers = null;\n    }\n\n    /**\n     * Enable or disable color writing\n     * @param enable defines the state to set\n     */\n    public setColorWrite(enable: boolean): void {\n        this.__colorWrite = enable;\n        this._cacheRenderPipeline.setWriteMask(enable ? 0xF : 0);\n    }\n\n    /**\n     * Gets a boolean indicating if color writing is enabled\n     * @returns the current color writing state\n     */\n    public getColorWrite(): boolean {\n        return this.__colorWrite;\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Dynamic WebGPU States\n    //------------------------------------------------------------------------------\n\n    // index 0 is for main render pass, 1 for RTT render pass\n    private _viewportsCurrent: Array<{ x: number, y: number, w: number, h: number }> = [{ x: 0, y: 0, w: 0, h: 0 }, { x: 0, y: 0, w: 0, h: 0 }];\n\n    private _resetCurrentViewport(index: number) {\n        this._viewportsCurrent[index].x = 0;\n        this._viewportsCurrent[index].y = 0;\n        this._viewportsCurrent[index].w = 0;\n        this._viewportsCurrent[index].h = 0;\n\n        if (index === 1) {\n            this._viewportCached.x = 0;\n            this._viewportCached.y = 0;\n            this._viewportCached.z = 0;\n            this._viewportCached.w = 0;\n        }\n    }\n\n    private _mustUpdateViewport(renderPass: GPURenderPassEncoder): boolean {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n\n        const x = this._viewportCached.x,\n            y = this._viewportCached.y,\n            w = this._viewportCached.z,\n            h = this._viewportCached.w;\n\n        const update =\n            this._viewportsCurrent[index].x !== x || this._viewportsCurrent[index].y !== y ||\n            this._viewportsCurrent[index].w !== w || this._viewportsCurrent[index].h !== h;\n\n        if (update) {\n            this._viewportsCurrent[index].x = this._viewportCached.x;\n            this._viewportsCurrent[index].y = this._viewportCached.y;\n            this._viewportsCurrent[index].w = this._viewportCached.z;\n            this._viewportsCurrent[index].h = this._viewportCached.w;\n        }\n\n        return update;\n    }\n\n    private _applyViewport(renderPass: GPURenderPassEncoder): void {\n        renderPass.setViewport(Math.floor(this._viewportCached.x), Math.floor(this._viewportCached.y), Math.floor(this._viewportCached.z), Math.floor(this._viewportCached.w), 0, 1);\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - viewport applied - (\", this._viewportCached.x, this._viewportCached.y, this._viewportCached.z, this._viewportCached.w, \") current pass is main pass=\" + (renderPass === this._mainRenderPassWrapper.renderPass));\n            }\n        }\n    }\n\n    /** @hidden */\n    public _viewport(x: number, y: number, width: number, height: number): void {\n        this._viewportCached.x = x;\n        this._viewportCached.y = y;\n        this._viewportCached.z = width;\n        this._viewportCached.w = height;\n    }\n\n    private _scissorsCurrent: Array<{ x: number, y: number, w: number, h: number }> = [{ x: 0, y: 0, w: 0, h: 0 }, { x: 0, y: 0, w: 0, h: 0 }];\n    protected _scissorCached = { x: 0, y: 0, z: 0, w: 0 };\n\n    private _resetCurrentScissor(index: number) {\n        this._scissorsCurrent[index].x = 0;\n        this._scissorsCurrent[index].y = 0;\n        this._scissorsCurrent[index].w = 0;\n        this._scissorsCurrent[index].h = 0;\n    }\n\n    private _mustUpdateScissor(renderPass: GPURenderPassEncoder): boolean {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n\n        const x = this._scissorCached.x,\n            y = this._scissorCached.y,\n            w = this._scissorCached.z,\n            h = this._scissorCached.w;\n\n        const update =\n            this._scissorsCurrent[index].x !== x || this._scissorsCurrent[index].y !== y ||\n            this._scissorsCurrent[index].w !== w || this._scissorsCurrent[index].h !== h;\n\n        if (update) {\n            this._scissorsCurrent[index].x = this._scissorCached.x;\n            this._scissorsCurrent[index].y = this._scissorCached.y;\n            this._scissorsCurrent[index].w = this._scissorCached.z;\n            this._scissorsCurrent[index].h = this._scissorCached.w;\n        }\n\n        return update;\n    }\n\n    private _applyScissor(renderPass: GPURenderPassEncoder): void {\n        renderPass.setScissorRect(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w);\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - scissor applied - (\", this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w, \") current pass is main pass=\" + (renderPass === this._mainRenderPassWrapper.renderPass));\n            }\n        }\n    }\n\n    private _scissorIsActive() {\n        return this._scissorCached.x !== 0 ||\n            this._scissorCached.y !== 0 ||\n            this._scissorCached.z !== 0 ||\n            this._scissorCached.w !== 0;\n    }\n\n    public enableScissor(x: number, y: number, width: number, height: number): void {\n        this._scissorCached.x = x;\n        this._scissorCached.y = y;\n        this._scissorCached.z = width;\n        this._scissorCached.w = height;\n    }\n\n    public disableScissor() {\n        this._scissorCached.x = 0;\n        this._scissorCached.y = 0;\n        this._scissorCached.z = 0;\n        this._scissorCached.w = 0;\n\n        this._resetCurrentScissor(0);\n        this._resetCurrentScissor(1);\n    }\n\n    private _stencilRefsCurrent: Array<number> = [-1, -1];\n\n    private _resetCurrentStencilRef(index: number): void {\n        this._stencilRefsCurrent[index] = -1;\n    }\n\n    private _mustUpdateStencilRef(renderPass: GPURenderPassEncoder): boolean {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n        const update = this._stencilStateComposer.funcRef !== this._stencilRefsCurrent[index];\n        if (update) {\n            this._stencilRefsCurrent[index] = this._stencilStateComposer.funcRef;\n        }\n        return update;\n    }\n\n    /** @hidden */\n    public _applyStencilRef(renderPass: GPURenderPassEncoder): void {\n        renderPass.setStencilReference(this._stencilStateComposer.funcRef ?? 0);\n    }\n\n    private _blendColorsCurrent: Array<Array<Nullable<number>>> = [[null, null, null, null], [null, null, null, null]];\n\n    private _resetCurrentColorBlend(index: number): void {\n        this._blendColorsCurrent[index][0] =\n            this._blendColorsCurrent[index][1] =\n            this._blendColorsCurrent[index][2] =\n            this._blendColorsCurrent[index][3] = null;\n    }\n\n    private _mustUpdateBlendColor(renderPass: GPURenderPassEncoder): boolean {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n        const colorBlend = this._alphaState._blendConstants;\n\n        const update =\n            colorBlend[0] !== this._blendColorsCurrent[index][0] ||\n            colorBlend[1] !== this._blendColorsCurrent[index][1] ||\n            colorBlend[2] !== this._blendColorsCurrent[index][2] ||\n            colorBlend[3] !== this._blendColorsCurrent[index][3];\n\n        if (update) {\n            this._blendColorsCurrent[index][0] = colorBlend[0];\n            this._blendColorsCurrent[index][1] = colorBlend[1];\n            this._blendColorsCurrent[index][2] = colorBlend[2];\n            this._blendColorsCurrent[index][3] = colorBlend[3];\n        }\n\n        return update;\n    }\n\n    private _applyBlendColor(renderPass: GPURenderPassEncoder): void {\n        renderPass.setBlendConstant(this._alphaState._blendConstants as GPUColor);\n    }\n\n    /**\n     * Clear the current render buffer or the current render target (if any is set up)\n     * @param color defines the color to use\n     * @param backBuffer defines if the back buffer must be cleared\n     * @param depth defines if the depth buffer must be cleared\n     * @param stencil defines if the stencil buffer must be cleared\n     */\n    public clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\n        // Some PGs are using color3...\n        if (color && color.a === undefined) {\n            color.a = 1;\n        }\n\n        const hasScissor = this._scissorIsActive();\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - clear called - backBuffer=\", backBuffer, \" depth=\", depth, \" stencil=\", stencil, \" scissor is active=\", hasScissor);\n            }\n        }\n\n        // We need to recreate the render pass so that the new parameters for clear color / depth / stencil are taken into account\n        if (this._currentRenderTarget) {\n            if (hasScissor) {\n                if (!this._rttRenderPassWrapper.renderPass) {\n                    this._startRenderTargetRenderPass(this._currentRenderTarget!, false, backBuffer ? color : null, depth, stencil);\n                }\n                if (!this.compatibilityMode) {\n                    this._bundleListRenderTarget.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\n                } else {\n                    this._applyScissor(this._currentRenderPass!);\n                }\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\n            } else {\n                if (this._currentRenderPass) {\n                    this._endRenderTargetRenderPass();\n                }\n                this._startRenderTargetRenderPass(this._currentRenderTarget!, true, backBuffer ? color : null, depth, stencil);\n            }\n        } else {\n            if (!this._mainRenderPassWrapper.renderPass || !hasScissor) {\n                this._startMainRenderPass(!hasScissor, backBuffer ? color : null, depth, stencil);\n            }\n            if (hasScissor) {\n                if (!this.compatibilityMode) {\n                    this._bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\n                } else {\n                    this._applyScissor(this._currentRenderPass!);\n                }\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\n            }\n        }\n    }\n\n    private _clearFullQuad(clearColor?: Nullable<IColor4Like>, clearDepth?: boolean, clearStencil?: boolean): void {\n        const renderPass = !this.compatibilityMode ? null : this._getCurrentRenderPass();\n        const renderPassIndex = this._getCurrentRenderPassIndex();\n        const bundleList = renderPassIndex === 0 ? this._bundleList : this._bundleListRenderTarget;\n\n        this._clearQuad.setColorFormat(this._colorFormat);\n        this._clearQuad.setDepthStencilFormat(this._depthTextureFormat);\n        this._clearQuad.setMRTAttachments(this._cacheRenderPipeline.mrtAttachments ?? [], this._cacheRenderPipeline.mrtTextureArray ?? []);\n\n        if (!this.compatibilityMode) {\n            bundleList.addItem(new WebGPURenderItemStencilRef(this._clearStencilValue));\n        } else {\n            renderPass!.setStencilReference(this._clearStencilValue);\n        }\n\n        const bundle = this._clearQuad.clear(renderPass, clearColor, clearDepth, clearStencil, this.currentSampleCount);\n\n        if (!this.compatibilityMode) {\n            bundleList.addBundle(bundle!);\n            bundleList.addItem(new WebGPURenderItemStencilRef(this._stencilStateComposer.funcRef ?? 0));\n            this._reportDrawCall();\n        } else {\n            this._applyStencilRef(renderPass!);\n        }\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Vertex/Index/Storage Buffers\n    //------------------------------------------------------------------------------\n\n    /**\n     * Creates a vertex buffer\n     * @param data the data for the vertex buffer\n     * @returns the new buffer\n     */\n    public createVertexBuffer(data: DataArray): DataBuffer {\n        let view: ArrayBufferView;\n\n        if (data instanceof Array) {\n            view = new Float32Array(data);\n        }\n        else if (data instanceof ArrayBuffer) {\n            view = new Uint8Array(data);\n        }\n        else {\n            view = data;\n        }\n\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Vertex | WebGPUConstants.BufferUsage.CopyDst);\n        return dataBuffer;\n    }\n\n    /**\n     * Creates a vertex buffer\n     * @param data the data for the dynamic vertex buffer\n     * @returns the new buffer\n     */\n    public createDynamicVertexBuffer(data: DataArray): DataBuffer {\n        return this.createVertexBuffer(data);\n    }\n\n    /**\n     * Creates a new index buffer\n     * @param indices defines the content of the index buffer\n     * @param updatable defines if the index buffer must be updatable - not used in WebGPU\n     * @returns a new buffer\n     */\n    public createIndexBuffer(indices: IndicesArray, updatable?: boolean): DataBuffer {\n        let is32Bits = true;\n        let view: ArrayBufferView;\n\n        if (indices instanceof Uint32Array || indices instanceof Int32Array) {\n            view = indices;\n        }\n        else if (indices instanceof Uint16Array) {\n            view = indices;\n            is32Bits = false;\n        }\n        else {\n            if (indices.length > 65535) {\n                view = new Uint32Array(indices);\n            }\n            else {\n                view = new Uint16Array(indices);\n                is32Bits = false;\n            }\n        }\n\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Index | WebGPUConstants.BufferUsage.CopyDst);\n        dataBuffer.is32Bits = is32Bits;\n        return dataBuffer;\n    }\n\n    /** @hidden */\n    public _createBuffer(data: DataArray | number, creationFlags: number): DataBuffer {\n        let view: ArrayBufferView | number;\n\n        if (data instanceof Array) {\n            view = new Float32Array(data);\n        }\n        else if (data instanceof ArrayBuffer) {\n            view = new Uint8Array(data);\n        }\n        else {\n            view = data;\n        }\n\n        let flags = 0;\n        if (creationFlags & 1) {\n            flags |= WebGPUConstants.BufferUsage.CopySrc;\n        }\n        if (creationFlags & 2) {\n            flags |= WebGPUConstants.BufferUsage.CopyDst;\n        }\n        if (creationFlags & 4) {\n            flags |= WebGPUConstants.BufferUsage.Uniform;\n        }\n        if (creationFlags & 8) {\n            flags |= WebGPUConstants.BufferUsage.Vertex;\n        }\n        if (creationFlags & 16) {\n            flags |= WebGPUConstants.BufferUsage.Index;\n        }\n        if (creationFlags & 32) {\n            flags |= WebGPUConstants.BufferUsage.Storage;\n        }\n\n        return this._bufferManager.createBuffer(view, flags);\n    }\n\n    /** @hidden */\n    public bindBuffersDirectly(vertexBuffer: DataBuffer, indexBuffer: DataBuffer, vertexDeclaration: number[], vertexStrideSize: number, effect: Effect): void {\n        throw \"Not implemented on WebGPU\";\n    }\n\n    /** @hidden */\n    public updateAndBindInstancesBuffer(instancesBuffer: DataBuffer, data: Float32Array, offsetLocations: number[] | InstancingAttributeInfo[]): void {\n        throw \"Not implemented on WebGPU\";\n    }\n\n    /**\n     * Bind a list of vertex buffers with the engine\n     * @param vertexBuffers defines the list of vertex buffers to bind\n     * @param indexBuffer defines the index buffer to bind\n     * @param effect defines the effect associated with the vertex buffers\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\n     */\n    public bindBuffers(vertexBuffers: { [key: string]: Nullable<VertexBuffer> }, indexBuffer: Nullable<DataBuffer>, effect: Effect, overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }): void {\n        this._currentIndexBuffer = indexBuffer;\n        this._currentOverrideVertexBuffers = overrideVertexBuffers ?? null;\n        this._cacheRenderPipeline.setBuffers(vertexBuffers, indexBuffer, this._currentOverrideVertexBuffers);\n    }\n\n    /** @hidden */\n    public _releaseBuffer(buffer: DataBuffer): boolean {\n        return this._bufferManager.releaseBuffer(buffer);\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Effects\n    //------------------------------------------------------------------------------\n\n    /**\n     * Create a new effect (used to store vertex/fragment shaders)\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\n     * @param samplers defines an array of string used to represent textures\n     * @param defines defines the string containing the defines to use to compile the shaders\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\n     * @param onCompiled defines a function to call when the effect creation is successful\n     * @param onError defines a function to call when the effect creation has failed\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\n     * @returns the new Effect\n     */\n    public createEffect(baseName: any, attributesNamesOrOptions: string[] | IEffectCreationOptions, uniformsNamesOrEngine: string[] | Engine, samplers?: string[], defines?: string, fallbacks?: EffectFallbacks,\n        onCompiled?: Nullable<(effect: Effect) => void>, onError?: Nullable<(effect: Effect, errors: string) => void>, indexParameters?: any, shaderLanguage = ShaderLanguage.GLSL): Effect {\n        const vertex = baseName.vertexElement || baseName.vertex || baseName.vertexToken || baseName.vertexSource || baseName;\n        const fragment = baseName.fragmentElement || baseName.fragment || baseName.fragmentToken || baseName.fragmentSource || baseName;\n        const globalDefines = this._getGlobalDefines()!;\n\n        let fullDefines = defines ?? (<IEffectCreationOptions>attributesNamesOrOptions).defines ?? \"\";\n\n        if (globalDefines) {\n            fullDefines += \"\\n\" + globalDefines;\n        }\n\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\n        if (this._compiledEffects[name]) {\n            var compiledEffect = <Effect>this._compiledEffects[name];\n            if (onCompiled && compiledEffect.isReady()) {\n                onCompiled(compiledEffect);\n            }\n\n            return compiledEffect;\n        }\n        var effect = new Effect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, this, defines, fallbacks, onCompiled, onError, indexParameters, name, shaderLanguage);\n        this._compiledEffects[name] = effect;\n\n        return effect;\n    }\n\n    private _compileRawShaderToSpirV(source: string, type: string): Uint32Array {\n        return this._glslang.compileGLSL(source, type);\n    }\n\n    private _compileShaderToSpirV(source: string, type: string, defines: Nullable<string>, shaderVersion: string): Uint32Array {\n        return this._compileRawShaderToSpirV(shaderVersion + (defines ? defines + \"\\n\" : \"\") + source, type);\n    }\n\n    private _getWGSLShader(source: string, type: string, defines: Nullable<string>, shaderVersion: string): string {\n        if (defines) {\n            defines = \"//\" + defines.split(\"\\n\").join(\"\\n//\") + \"\\n\";\n        } else {\n            defines = \"\";\n        }\n        return defines + source;\n    }\n\n    private _createPipelineStageDescriptor(vertexShader: Uint32Array | string, fragmentShader: Uint32Array | string, shaderLanguage: ShaderLanguage): IWebGPURenderPipelineStageDescriptor {\n        if (this._tintWASM && shaderLanguage === ShaderLanguage.GLSL) {\n            vertexShader = this._tintWASM.convertSpirV2WGSL(vertexShader as Uint32Array) as any;\n            fragmentShader = this._tintWASM.convertSpirV2WGSL(fragmentShader as Uint32Array) as any;\n        }\n\n        return {\n            vertexStage: {\n                module: this._device.createShaderModule({\n                    code: vertexShader,\n                }),\n                entryPoint: \"main\",\n            },\n            fragmentStage: {\n                module: this._device.createShaderModule({\n                    code: fragmentShader,\n                }),\n                entryPoint: \"main\"\n            }\n        };\n    }\n\n    private _compileRawPipelineStageDescriptor(vertexCode: string, fragmentCode: string, shaderLanguage: ShaderLanguage): IWebGPURenderPipelineStageDescriptor {\n        var vertexShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileRawShaderToSpirV(vertexCode, \"vertex\") : vertexCode;\n        var fragmentShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileRawShaderToSpirV(fragmentCode, \"fragment\") : fragmentCode;\n\n        return this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage);\n    }\n\n    private _compilePipelineStageDescriptor(vertexCode: string, fragmentCode: string, defines: Nullable<string>, shaderLanguage: ShaderLanguage): IWebGPURenderPipelineStageDescriptor {\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\n\n        var shaderVersion = \"#version 450\\n\";\n        var vertexShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileShaderToSpirV(vertexCode, \"vertex\", defines, shaderVersion) : this._getWGSLShader(vertexCode, \"vertex\", defines, shaderVersion);\n        var fragmentShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileShaderToSpirV(fragmentCode, \"fragment\", defines, shaderVersion) : this._getWGSLShader(fragmentCode, \"fragment\", defines, shaderVersion);\n\n        let program = this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage);\n\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\n\n        return program;\n    }\n\n    /** @hidden */\n    public createRawShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): WebGLProgram {\n        throw \"Not available on WebGPU\";\n    }\n\n    /** @hidden */\n    public createShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, defines: Nullable<string>, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): WebGLProgram {\n        throw \"Not available on WebGPU\";\n    }\n\n    /**\n     * Inline functions in shader code that are marked to be inlined\n     * @param code code to inline\n     * @returns inlined code\n     */\n    public inlineShaderCode(code: string): string {\n        const sci = new ShaderCodeInliner(code);\n        sci.debug = false;\n        sci.processCode();\n        return sci.code;\n    }\n\n    /**\n     * Creates a new pipeline context\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\n     * @returns the new pipeline\n     */\n    public createPipelineContext(shaderProcessingContext: Nullable<ShaderProcessingContext>): IPipelineContext {\n        return new WebGPUPipelineContext(shaderProcessingContext! as WebGPUShaderProcessingContext, this);\n    }\n\n    /**\n     * Creates a new material context\n     * @returns the new context\n     */\n    public createMaterialContext(): WebGPUMaterialContext | undefined {\n        return new WebGPUMaterialContext();\n    }\n\n    /**\n     * Creates a new draw context\n     * @returns the new context\n     */\n    public createDrawContext(): WebGPUDrawContext | undefined {\n        return new WebGPUDrawContext(this._bufferManager);\n    }\n\n    /** @hidden */\n    public _preparePipelineContext(pipelineContext: IPipelineContext, vertexSourceCode: string, fragmentSourceCode: string, createAsRaw: boolean, rawVertexSourceCode: string, rawFragmentSourceCode: string,\n        rebuildRebind: any,\n        defines: Nullable<string>,\n        transformFeedbackVaryings: Nullable<string[]>,\n        key: string) {\n        const webGpuContext = pipelineContext as WebGPUPipelineContext;\n        const shaderLanguage = webGpuContext.shaderProcessingContext.shaderLanguage;\n\n        if (this.dbgShowShaderCode) {\n            console.log(defines);\n            console.log(vertexSourceCode);\n            console.log(fragmentSourceCode);\n        }\n\n        webGpuContext.sources = {\n            fragment: fragmentSourceCode,\n            vertex: vertexSourceCode,\n            rawVertex: rawVertexSourceCode,\n            rawFragment: rawFragmentSourceCode,\n        };\n\n        if (createAsRaw) {\n            webGpuContext.stages = this._compileRawPipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, shaderLanguage);\n        } else {\n            webGpuContext.stages = this._compilePipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, defines, shaderLanguage);\n        }\n    }\n\n    /**\n     * Gets the list of active attributes for a given WebGPU program\n     * @param pipelineContext defines the pipeline context to use\n     * @param attributesNames defines the list of attribute names to get\n     * @returns an array of indices indicating the offset of each attribute\n     */\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\n        const results = new Array(attributesNames.length);\n        const gpuPipelineContext = (pipelineContext as WebGPUPipelineContext);\n\n        for (let i = 0; i < attributesNames.length; i++) {\n            const attributeName = attributesNames[i];\n            const attributeLocation = gpuPipelineContext.shaderProcessingContext.availableAttributes[attributeName];\n            if (attributeLocation === undefined) {\n                continue;\n            }\n\n            results[i] = attributeLocation;\n        }\n\n        return results;\n    }\n\n    /**\n     * Activates an effect, mkaing it the current one (ie. the one used for rendering)\n     * @param effect defines the effect to activate\n     */\n    public enableEffect(effect: Nullable<Effect | DrawWrapper>): void {\n        if (!effect) {\n            return;\n        }\n\n        let isNewEffect = true;\n\n        if (!DrawWrapper.IsWrapper(effect)) {\n            isNewEffect = effect !== this._currentEffect;\n            this._currentEffect = effect;\n            this._currentMaterialContext = this._defaultMaterialContext;\n            this._currentDrawContext = this._defaultDrawContext;\n            this._counters.numEnableEffects++;\n            if (this.dbgLogIfNotDrawWrapper) {\n                Logger.Warn(`enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=${effect.uniqueId}, effect.name=${effect.name}, effect.name.vertex=${effect.name.vertex}, effect.name.fragment=${effect.name.fragment}`, 10);\n            }\n        } else if (!effect.effect || effect.effect === this._currentEffect && effect.materialContext === this._currentMaterialContext && effect.drawContext === this._currentDrawContext && !this._forceEnableEffect) {\n            if (!effect.effect && this.dbgShowEmptyEnableEffectCalls) {\n                console.error(\"drawWrapper=\", effect);\n                throw \"Invalid call to enableEffect: the effect property is empty!\";\n            }\n            return;\n        } else {\n            isNewEffect = effect.effect !== this._currentEffect;\n            this._currentEffect = effect.effect;\n            this._currentMaterialContext = effect.materialContext as WebGPUMaterialContext;\n            this._currentDrawContext = effect.drawContext as WebGPUDrawContext;\n            this._counters.numEnableDrawWrapper++;\n            if (!this._currentMaterialContext) {\n                console.error(\"drawWrapper=\", effect);\n                throw `Invalid call to enableEffect: the materialContext property is empty!`;\n            }\n        }\n\n        this._stencilStateComposer.stencilMaterial = undefined;\n\n        this._forceEnableEffect = isNewEffect || this._forceEnableEffect ? false : this._forceEnableEffect;\n\n        if (isNewEffect) {\n            if (this._currentEffect!.onBind) {\n                this._currentEffect!.onBind(this._currentEffect!);\n            }\n            if (this._currentEffect!._onBindObservable) {\n                this._currentEffect!._onBindObservable.notifyObservers(this._currentEffect!);\n            }\n        }\n    }\n\n    /** @hidden */\n    public _releaseEffect(effect: Effect): void {\n        if (this._compiledEffects[effect._key]) {\n            delete this._compiledEffects[effect._key];\n\n            this._deletePipelineContext(effect.getPipelineContext() as WebGPUPipelineContext);\n        }\n    }\n\n    /**\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\n     */\n    public releaseEffects() {\n        for (const name in this._compiledEffects) {\n            const webGPUPipelineContext = this._compiledEffects[name].getPipelineContext() as WebGPUPipelineContext;\n            this._deletePipelineContext(webGPUPipelineContext);\n        }\n\n        this._compiledEffects = {};\n    }\n\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\n        const webgpuPipelineContext = pipelineContext as WebGPUPipelineContext;\n        if (webgpuPipelineContext) {\n            pipelineContext.dispose();\n        }\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Textures\n    //------------------------------------------------------------------------------\n\n    /**\n     * Gets a boolean indicating that only power of 2 textures are supported\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\n     */\n    public get needPOTTextures(): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public _createHardwareTexture(): HardwareTextureWrapper {\n        return new WebGPUHardwareTexture();\n    }\n\n    /** @hidden */\n    public _releaseTexture(texture: InternalTexture): void {\n        const index = this._internalTexturesCache.indexOf(texture);\n        if (index !== -1) {\n            this._internalTexturesCache.splice(index, 1);\n        }\n\n        this._textureHelper.releaseTexture(texture);\n    }\n\n    /** @hidden */\n    public _getRGBABufferInternalSizedFormat(type: number, format?: number): number {\n        return 5;\n    }\n\n    public updateTextureComparisonFunction(texture: InternalTexture, comparisonFunction: number): void {\n        texture._comparisonFunction = comparisonFunction;\n    }\n\n    /**\n     * Creates an internal texture without binding it to a framebuffer\n     * @hidden\n     * @param size defines the size of the texture\n     * @param options defines the options used to create the texture\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\n     * @param source source type of the texture\n     * @returns a new render target texture stored in an InternalTexture\n     */\n    public _createInternalTexture(size: TextureSize, options: boolean | InternalTextureCreationOptions, delayGPUTextureCreation = true, source = InternalTextureSource.Unknown): InternalTexture {\n        const fullOptions: InternalTextureCreationOptions = {};\n\n        if (options !== undefined && typeof options === \"object\") {\n            fullOptions.generateMipMaps = options.generateMipMaps;\n            fullOptions.type = options.type === undefined ? 0 : options.type;\n            fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n            fullOptions.format = options.format === undefined ? 5 : options.format;\n            fullOptions.samples = options.samples ?? 1;\n            fullOptions.creationFlags = options.creationFlags ?? 0;\n        } else {\n            fullOptions.generateMipMaps = <boolean>options;\n            fullOptions.type = 0;\n            fullOptions.samplingMode = 3;\n            fullOptions.format = 5;\n            fullOptions.samples = 1;\n            fullOptions.creationFlags = 0;\n        }\n\n        if (fullOptions.type === 1 && !this._caps.textureFloatLinearFiltering) {\n            fullOptions.samplingMode = 1;\n        } else if (fullOptions.type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n            fullOptions.samplingMode = 1;\n        }\n        if (fullOptions.type === 1 && !this._caps.textureFloat) {\n            fullOptions.type = 0;\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\n        }\n\n        const texture = new InternalTexture(this, source);\n\n        const width = (<{ width: number; height: number; layers?: number }>size).width || <number>size;\n        const height = (<{ width: number; height: number; layers?: number }>size).height || <number>size;\n        const layers = (<{ width: number; height: number; layers?: number }>size).layers || 0;\n\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.width = width;\n        texture.height = height;\n        texture.depth = layers;\n        texture.isReady = true;\n        texture.samples = fullOptions.samples;\n        texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\n        texture.samplingMode = fullOptions.samplingMode;\n        texture.type = fullOptions.type;\n        texture.format = fullOptions.format;\n        texture.is2DArray = layers > 0;\n        texture._cachedWrapU = 0;\n        texture._cachedWrapV = 0;\n\n        this._internalTexturesCache.push(texture);\n\n        if (!delayGPUTextureCreation) {\n            this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, layers || 1, fullOptions.creationFlags);\n        }\n\n        return texture;\n    }\n\n    /**\n     * Usually called from Texture.ts.\n     * Passed information to create a hardware texture\n     * @param url defines a value which contains one of the following:\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\n     * @param scene needed for loading to the correct scene\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\n     * @param onLoad optional callback to be called upon successful completion\n     * @param onError optional callback to be called upon failure\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param mimeType defines an optional mime type\n     * @param loaderOptions options to be passed to the loader\n     * @param creationFlags specific flags to use when creating the texture (1 for storage textures, for eg)\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\n     */\n    public createTexture(url: Nullable<string>, noMipmap: boolean, invertY: boolean, scene: Nullable<ISceneLike>, samplingMode: number = 3,\n        onLoad: Nullable<() => void> = null, onError: Nullable<(message: string, exception: any) => void> = null,\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null, fallback: Nullable<InternalTexture> = null, format: Nullable<number> = null,\n        forcedExtension: Nullable<string> = null, mimeType?: string, loaderOptions?: any, creationFlags?: number, useSRGBBuffer?: boolean): InternalTexture {\n\n        return this._createTextureBase(\n            url, noMipmap, invertY, scene, samplingMode, onLoad, onError,\n            (texture: InternalTexture, extension: string, scene: Nullable<ISceneLike>, img: HTMLImageElement | ImageBitmap | { width: number, height: number }, invertY: boolean, noMipmap: boolean, isCompressed: boolean,\n                processFunction: (width: number, height: number, img: HTMLImageElement | ImageBitmap | { width: number, height: number }, extension: string, texture: InternalTexture, continuationCallback: () => void) => boolean, samplingMode: number) => {\n                const imageBitmap = img as (ImageBitmap | { width: number, height: number }); // we will never get an HTMLImageElement in WebGPU\n\n                texture.baseWidth = imageBitmap.width;\n                texture.baseHeight = imageBitmap.height;\n                texture.width = imageBitmap.width;\n                texture.height = imageBitmap.height;\n                texture.format = format ?? -1;\n\n                processFunction(texture.width, texture.height, imageBitmap, extension, texture, () => { });\n\n                if (!texture._hardwareTexture?.underlyingResource) { // the texture could have been created before reaching this point so don't recreate it if already existing\n                    const gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, imageBitmap.width, imageBitmap.height, undefined, creationFlags);\n\n                    if (WebGPUTextureHelper.IsImageBitmap(imageBitmap)) {\n                        this._textureHelper.updateTexture(imageBitmap, texture, imageBitmap.width, imageBitmap.height, texture.depth, gpuTextureWrapper.format, 0, 0, invertY, false, 0, 0, this._uploadEncoder);\n                        if (!noMipmap && !isCompressed) {\n                            this._generateMipmaps(texture, this._uploadEncoder);\n                        }\n                    }\n                } else if (!noMipmap && !isCompressed) {\n                    this._generateMipmaps(texture, this._uploadEncoder);\n                }\n\n                if (scene) {\n                    scene._removePendingData(texture);\n                }\n\n                texture.isReady = true;\n\n                texture.onLoadedObservable.notifyObservers(texture);\n                texture.onLoadedObservable.clear();\n            },\n            () => false,\n            buffer, fallback, format, forcedExtension, mimeType, loaderOptions, useSRGBBuffer\n        );\n    }\n\n    public generateMipMapsForCubemap(texture: InternalTexture, unbind = true) {\n        if (texture.generateMipMaps) {\n            let gpuTexture = texture._hardwareTexture?.underlyingResource;\n\n            if (!gpuTexture) {\n                this._textureHelper.createGPUTextureForInternalTexture(texture);\n            }\n\n            this._generateMipmaps(texture, texture.source === InternalTextureSource.RenderTarget || texture.source === InternalTextureSource.MultiRenderTarget ? this._renderTargetEncoder : undefined);\n        }\n    }\n\n    /**\n     * Update the sampling mode of a given texture\n     * @param samplingMode defines the required sampling mode\n     * @param texture defines the texture to update\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\n     */\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture, generateMipMaps: boolean = false): void {\n        if (generateMipMaps) {\n            texture.generateMipMaps = true;\n            this._generateMipmaps(texture);\n        }\n\n        texture.samplingMode = samplingMode;\n    }\n\n    /**\n     * Update the sampling mode of a given texture\n     * @param texture defines the texture to update\n     * @param wrapU defines the texture wrap mode of the u coordinates\n     * @param wrapV defines the texture wrap mode of the v coordinates\n     * @param wrapR defines the texture wrap mode of the r coordinates\n     */\n    public updateTextureWrappingMode(texture: InternalTexture, wrapU: Nullable<number>, wrapV: Nullable<number> = null, wrapR: Nullable<number> = null): void {\n        if (wrapU !== null) {\n            texture._cachedWrapU = wrapU;\n        }\n        if (wrapV !== null) {\n            texture._cachedWrapV = wrapV;\n        }\n        if ((texture.is2DArray || texture.is3D) && (wrapR !== null)) {\n            texture._cachedWrapR = wrapR;\n        }\n    }\n\n    /**\n     * Update the dimensions of a texture\n     * @param texture texture to update\n     * @param width new width of the texture\n     * @param height new height of the texture\n     * @param depth new depth of the texture\n     */\n    public updateTextureDimensions(texture: InternalTexture, width: number, height: number, depth: number = 1): void {\n        if (!texture._hardwareTexture) {\n            // the gpu texture is not created yet, so when it is it will be created with the right dimensions\n            return;\n        }\n\n        if (texture.width === width && texture.height === height && texture.depth === depth) {\n            return;\n        }\n\n        const additionalUsages = (texture._hardwareTexture as WebGPUHardwareTexture).textureAdditionalUsages;\n\n        texture._hardwareTexture.release(); // don't defer the releasing! Else we will release at the end of this frame the gpu texture we are about to create in the next line...\n\n        this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, depth, additionalUsages);\n    }\n\n    /** @hidden */\n    public _setInternalTexture(name: string, texture: Nullable<InternalTexture | ExternalTexture>, baseName?: string, textureIndex = 0): void {\n        baseName = baseName ?? name;\n        if (this._currentEffect) {\n            const webgpuPipelineContext = this._currentEffect._pipelineContext as WebGPUPipelineContext;\n            const availableTexture = webgpuPipelineContext.shaderProcessingContext.availableTextures[baseName];\n\n            this._currentMaterialContext.setTexture(name, texture);\n\n            if (availableTexture && availableTexture.autoBindSampler) {\n                const samplerName = baseName + WebGPUShaderProcessor.AutoSamplerSuffix;\n                this._currentMaterialContext.setSampler(samplerName, texture as InternalTexture); // we can safely cast to InternalTexture because ExternalTexture always has autoBindSampler = false\n            }\n        }\n    }\n\n    /**\n     * Sets a texture to the according uniform.\n     * @param channel The texture channel\n     * @param unused unused parameter\n     * @param texture The texture to apply\n     * @param name The name of the uniform in the effect\n     */\n    public setTexture(channel: number, unused: Nullable<WebGLUniformLocation>, texture: Nullable<BaseTexture>, name: string): void {\n        this._setTexture(channel, texture, false, false, name, name);\n    }\n\n    /**\n     * Sets an array of texture to the WebGPU context\n     * @param channel defines the channel where the texture array must be set\n     * @param unused unused parameter\n     * @param textures defines the array of textures to bind\n     * @param name name of the channel\n     */\n    public setTextureArray(channel: number, unused: Nullable<WebGLUniformLocation>, textures: BaseTexture[], name: string): void {\n        for (var index = 0; index < textures.length; index++) {\n            this._setTexture(-1, textures[index], true, false, name + index.toString(), name, index);\n        }\n    }\n\n    protected _setTexture(channel: number, texture: Nullable<BaseTexture>, isPartOfTextureArray = false, depthStencilTexture = false, name = \"\", baseName?: string, textureIndex = 0): boolean {\n        // name == baseName for a texture that is not part of a texture array\n        // Else, name is something like 'myTexture0' / 'myTexture1' / ... and baseName is 'myTexture'\n        // baseName is used to look up the sampler in the effectContext.samplers map\n        // name is used to look up the texture in the effectContext.textures map\n        baseName = baseName ?? name;\n        if (this._currentEffect) {\n            if (!texture) {\n                this._currentMaterialContext.setTexture(name, null);\n                return false;\n            }\n\n            // Video\n            if ((<VideoTexture>texture).video) {\n                (<VideoTexture>texture).update();\n            } else if (texture.delayLoadState === 4) { // Delay loading\n                texture.delayLoad();\n                return false;\n            }\n\n            let internalTexture: Nullable<InternalTexture> = null;\n            if (depthStencilTexture) {\n                internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\n            }\n            else if (texture.isReady()) {\n                internalTexture = <InternalTexture>texture.getInternalTexture();\n            }\n            else if (texture.isCube) {\n                internalTexture = this.emptyCubeTexture;\n            }\n            else if (texture.is3D) {\n                internalTexture = this.emptyTexture3D;\n            }\n            else if (texture.is2DArray) {\n                internalTexture = this.emptyTexture2DArray;\n            }\n            else {\n                internalTexture = this.emptyTexture;\n            }\n\n            if (internalTexture && !internalTexture.isMultiview) {\n                // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\n                if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\n                    internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\n\n                    const textureWrapMode = (texture.coordinatesMode !== 3 && texture.coordinatesMode !== 5) ? 1 : 0;\n                    texture.wrapU = textureWrapMode;\n                    texture.wrapV = textureWrapMode;\n                }\n\n                internalTexture._cachedWrapU = texture.wrapU;\n                internalTexture._cachedWrapV = texture.wrapV;\n                if (internalTexture.is3D) {\n                    internalTexture._cachedWrapR = texture.wrapR;\n                }\n\n                this._setAnisotropicLevel(0, internalTexture, texture.anisotropicFilteringLevel);\n            }\n\n            this._setInternalTexture(name, internalTexture, baseName, textureIndex);\n        } else {\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if ((this as any)._count === undefined) { (this as any)._count = 0; }\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                    console.log(\"frame #\" + (this as any)._count + \" - _setTexture called with a null _currentEffect! texture=\", texture);\n                }\n            }\n        }\n\n        return true;\n    }\n\n    /** @hidden */\n    public _setAnisotropicLevel(target: number, internalTexture: InternalTexture, anisotropicFilteringLevel: number) {\n        if (internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\n            internalTexture._cachedAnisotropicFilteringLevel = Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy);\n        }\n    }\n\n    /** @hidden */\n    public _bindTexture(channel: number, texture: InternalTexture, name: string): void {\n        if (channel === undefined) {\n            return;\n        }\n\n        this._setInternalTexture(name, texture);\n    }\n\n    /**\n     * Generates the mipmaps for a texture\n     * @param texture texture to generate the mipmaps for\n     */\n    public generateMipmaps(texture: InternalTexture): void {\n        this._generateMipmaps(texture, this._renderTargetEncoder);\n    }\n\n    /** @hidden */\n    public _generateMipmaps(texture: InternalTexture, commandEncoder?: GPUCommandEncoder) {\n        const gpuHardwareTexture = texture._hardwareTexture as Nullable<WebGPUHardwareTexture>;\n\n        if (!gpuHardwareTexture) {\n            return;\n        }\n\n        // try as much as possible to use the command encoder corresponding to the current pass.\n        // If not possible (because the pass is started - generateMipmaps itself creates a pass and it's not allowed to have a pass inside a pass), use _uploadEncoder\n        commandEncoder = commandEncoder ?? (this._currentRenderTarget && !this._currentRenderPass ? this._renderTargetEncoder : !this._currentRenderPass ? this._renderEncoder : this._uploadEncoder);\n\n        const format = (texture._hardwareTexture as WebGPUHardwareTexture).format;\n        const mipmapCount = WebGPUTextureHelper.ComputeNumMipmapLevels(texture.width, texture.height);\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - generate mipmaps called - width=\", texture.width, \"height=\", texture.height, \"isCube=\", texture.isCube);\n            }\n        }\n\n        if (texture.isCube) {\n            this._textureHelper.generateCubeMipmaps(gpuHardwareTexture, format, mipmapCount, commandEncoder);\n        } else {\n            this._textureHelper.generateMipmaps(gpuHardwareTexture, format, mipmapCount, 0, commandEncoder);\n        }\n    }\n\n    /**\n     * Update a portion of an internal texture\n     * @param texture defines the texture to update\n     * @param imageData defines the data to store into the texture\n     * @param xOffset defines the x coordinates of the update rectangle\n     * @param yOffset defines the y coordinates of the update rectangle\n     * @param width defines the width of the update rectangle\n     * @param height defines the height of the update rectangle\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\n     * @param lod defines the lod level to update (0 by default)\n     */\n    public updateTextureData(texture: InternalTexture, imageData: ArrayBufferView, xOffset: number, yOffset: number, width: number, height: number, faceIndex: number = 0, lod: number = 0): void {\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\n\n        if (!texture._hardwareTexture?.underlyingResource) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, xOffset, yOffset, this._uploadEncoder);\n    }\n\n    /** @hidden */\n    public _uploadCompressedDataToTextureDirectly(texture: InternalTexture, internalFormat: number, width: number, height: number, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0) {\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\n\n        if (!texture._hardwareTexture?.underlyingResource) {\n            texture.format = internalFormat;\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        }\n\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, false, false, 0, 0, this._uploadEncoder);\n    }\n\n    /** @hidden */\n    public _uploadDataToTextureDirectly(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0, babylonInternalFormat?: number, useTextureWidthAndHeight = false): void {\n        // TODO WEBPU babylonInternalFormat not handled.\n        // Note that it is used only by BasisTools.LoadTextureFromTranscodeResult when transcoding could not be done, and in that case the texture format used (TEXTURETYPE_UNSIGNED_SHORT_5_6_5) is not compatible with WebGPU...\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\n\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\n\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\n\n        if (!texture._hardwareTexture?.underlyingResource) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        }\n\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0, this._uploadEncoder);\n    }\n\n    /** @hidden */\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\n    }\n\n    /** @hidden */\n    public _uploadImageToTexture(texture: InternalTexture, image: HTMLImageElement | ImageBitmap, faceIndex: number = 0, lod: number = 0) {\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\n\n        if (!texture._hardwareTexture?.underlyingResource) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n\n        const bitmap = image as ImageBitmap; // in WebGPU we will always get an ImageBitmap, not an HTMLImageElement\n\n        const width = Math.ceil(texture.width / (1 << lod));\n        const height = Math.ceil(texture.height / (1 << lod));\n\n        this._textureHelper.updateTexture(bitmap, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0, this._uploadEncoder);\n    }\n\n    /**\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\n     * @param x defines the x coordinate of the rectangle where pixels must be read\n     * @param y defines the y coordinate of the rectangle where pixels must be read\n     * @param width defines the width of the rectangle where pixels must be read\n     * @param height defines the height of the rectangle where pixels must be read\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\n     */\n    public readPixels(x: number, y: number, width: number, height: number, hasAlpha = true, flushRenderer = true): Promise<ArrayBufferView> {\n        const renderPassWrapper = this._rttRenderPassWrapper.renderPass ? this._rttRenderPassWrapper : this._mainRenderPassWrapper;\n        const gpuTexture = renderPassWrapper.colorAttachmentGPUTextures![0].underlyingResource;\n        const gpuTextureFormat = renderPassWrapper.colorAttachmentGPUTextures![0].format;\n        if (!gpuTexture) {\n            // we are calling readPixels before startMainRenderPass has been called and no RTT is bound, so swapChainTexture is not setup yet!\n            return Promise.resolve(new Uint8Array(0));\n        }\n        if (flushRenderer) {\n            this.flushFramebuffer();\n        }\n        return this._textureHelper.readPixels(gpuTexture, x, y, width, height, gpuTextureFormat);\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Frame management\n    //------------------------------------------------------------------------------\n\n    /**\n     * Begin a new frame\n     */\n    public beginFrame(): void {\n        super.beginFrame();\n    }\n\n    /**\n     * End the current frame\n     */\n    public endFrame() {\n        this._snapshotRendering.endFrame(this._mainRenderPassWrapper.renderPass);\n\n        this._endMainRenderPass();\n\n        this._timestampQuery.endFrame(this._renderEncoder);\n\n        if (this._invertYFinalFramebuffer) {\n            if (this._mainRenderPassCopyWrapper.renderPassDescriptor!.colorAttachments[0].view) {\n                this._textureHelper.copyWithInvertY(this._mainTextureLastCopy.createView(), this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format, this._mainRenderPassCopyWrapper.renderPassDescriptor!, this._renderEncoder);\n            }\n        }\n\n        this.flushFramebuffer(false);\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - counters\");\n            }\n        }\n\n        this._textureHelper.destroyDeferredTextures();\n        this._bufferManager.destroyDeferredBuffers();\n\n        if (this._features._collectUbosUpdatedInFrame) {\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if ((this as any)._count === undefined) { (this as any)._count = 0; }\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                    const list: Array<string> = [];\n                    for (const name in UniformBuffer._updatedUbosInFrame) {\n                        list.push(name + \":\" + UniformBuffer._updatedUbosInFrame[name]);\n                    }\n                    console.log(\"frame #\" + (this as any)._count + \" - updated ubos -\", list.join(\", \"));\n                }\n            }\n            UniformBuffer._updatedUbosInFrame = {};\n        }\n\n        this.countersLastFrame.numEnableEffects = this._counters.numEnableEffects;\n        this.countersLastFrame.numEnableDrawWrapper = this._counters.numEnableDrawWrapper;\n        this.countersLastFrame.numBundleCreationNonCompatMode = this._counters.numBundleCreationNonCompatMode;\n        this.countersLastFrame.numBundleReuseNonCompatMode = this._counters.numBundleReuseNonCompatMode;\n        this._counters.numEnableEffects = 0;\n        this._counters.numEnableDrawWrapper = 0;\n        this._counters.numBundleCreationNonCompatMode = 0;\n        this._counters.numBundleReuseNonCompatMode = 0;\n\n        this._cacheRenderPipeline.endFrame();\n        this._cacheBindGroups.endFrame();\n\n        this._pendingDebugCommands.length = 0;\n\n        super.endFrame();\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if ((this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"%c frame #\" + (this as any)._count + \" - end\", \"background: #ffff00\");\n            }\n            if ((this as any)._count < this.dbgVerboseLogsNumFrames) {\n                (this as any)._count++;\n                if ((this as any)._count !== this.dbgVerboseLogsNumFrames) {\n                    console.log(\"%c frame #\" + (this as any)._count + \" - begin\", \"background: #ffff00\");\n                }\n            }\n        }\n    }\n\n    /**\n     * Force a WebGPU flush (ie. a flush of all waiting commands)\n     * @param reopenPass true to reopen at the end of the function the pass that was active when entering the function\n     */\n    public flushFramebuffer(reopenPass = true): void {\n        // we need to end the current render pass (main or rtt) if any as we are not allowed to submit the command buffers when being in a pass\n        const currentRenderPassIsNULL = !this._currentRenderPass;\n        let currentPasses = 0; // 0 if no pass, 1 for rtt, 2 for main pass\n        if (this._currentRenderPass && this._currentRenderTarget) {\n            currentPasses |= 1;\n            this._endRenderTargetRenderPass();\n        }\n        if (this._mainRenderPassWrapper.renderPass) {\n            currentPasses |= 2;\n            this._endMainRenderPass();\n        }\n\n        this._commandBuffers[0] = this._uploadEncoder.finish();\n        this._commandBuffers[1] = this._renderTargetEncoder.finish();\n        this._commandBuffers[2] = this._renderEncoder.finish();\n\n        this._device.queue.submit(this._commandBuffers);\n\n        this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\n        this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\n        this._renderTargetEncoder = this._device.createCommandEncoder(this._renderTargetEncoderDescriptor);\n\n        this._timestampQuery.startFrame(this._uploadEncoder);\n\n        this._textureHelper.setCommandEncoder(this._uploadEncoder);\n\n        this._bundleList.reset();\n        this._bundleListRenderTarget.reset();\n\n        // restart the render pass\n        if (reopenPass) {\n            if (currentPasses & 2) {\n                this._startMainRenderPass(false);\n            }\n            if (currentPasses & 1) {\n                this._startRenderTargetRenderPass(this._currentRenderTarget!, false, null, false, false);\n            }\n            if (currentRenderPassIsNULL && this._currentRenderTarget) {\n                this._currentRenderPass = null;\n            }\n        }\n    }\n\n    /** @hidden */\n    public _currentFrameBufferIsDefaultFrameBuffer() {\n        return this._currentRenderTarget === null;\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Render Pass\n    //------------------------------------------------------------------------------\n\n    private _startRenderTargetRenderPass(rtWrapper: RenderTargetWrapper, setClearStates: boolean, clearColor: Nullable<IColor4Like>, clearDepth: boolean, clearStencil: boolean) {\n        const depthStencilTexture = rtWrapper._depthStencilTexture;\n        const gpuDepthStencilWrapper = depthStencilTexture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\n        const gpuDepthStencilTexture = gpuDepthStencilWrapper?.underlyingResource as Nullable<GPUTexture>;\n        const gpuDepthStencilMSAATexture = gpuDepthStencilWrapper?.msaaTexture;\n\n        const depthTextureView = gpuDepthStencilTexture?.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor!);\n        const depthMSAATextureView = gpuDepthStencilMSAATexture?.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor!);\n\n        const colorAttachments: GPURenderPassColorAttachment[] = [];\n\n        if (this.useReverseDepthBuffer) {\n            this.setDepthFunctionToGreaterOrEqual();\n        }\n\n        const colorClearValue = !setClearStates ? WebGPUConstants.LoadOp.Load : clearColor ? clearColor : WebGPUConstants.LoadOp.Load;\n        const depthClearValue = !setClearStates ? WebGPUConstants.LoadOp.Load : clearDepth ? (this.useReverseDepthBuffer ? this._clearReverseDepthValue : this._clearDepthValue) : WebGPUConstants.LoadOp.Load;\n        const stencilClearValue = !setClearStates ? WebGPUConstants.LoadOp.Load : clearStencil ? this._clearStencilValue : WebGPUConstants.LoadOp.Load;\n\n        if (rtWrapper._attachments && rtWrapper.isMulti) {\n            // multi render targets\n            // We bind a texture only if this._mrtAttachments[i] !== 0\n            // It does work in the current state of Babylon (because we use _mrtAttachments only to include/exclude\n            // some textures from the clearing process) but it is not iso with WebGL!\n            // We should instead bind all textures but \"disable\" the textures for which this._mrtAttachments[i] == 0\n            // but it's not possible to do that in WebGPU (at least not as of 2021/03/03).\n            if (!this._mrtAttachments || this._mrtAttachments.length === 0) {\n                this._mrtAttachments = rtWrapper._attachments;\n            }\n            for (let i = 0; i < this._mrtAttachments.length; ++i) {\n                const index = this._mrtAttachments[i];\n                if (index === 0) {\n                    continue;\n                }\n                const mrtTexture = rtWrapper.textures![index - 1];\n                const gpuMRTWrapper = mrtTexture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\n                const gpuMRTTexture = gpuMRTWrapper?.underlyingResource;\n                if (gpuMRTWrapper && gpuMRTTexture) {\n                    const viewDescriptor = {\n                        ...this._rttRenderPassWrapper.colorAttachmentViewDescriptor!,\n                        format: gpuMRTWrapper.format,\n                    };\n                    const gpuMSAATexture = gpuMRTWrapper.msaaTexture;\n                    const colorTextureView = gpuMRTTexture.createView(viewDescriptor);\n                    const colorMSAATextureView = gpuMSAATexture?.createView(viewDescriptor);\n\n                    colorAttachments.push({\n                        view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\n                        resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\n                        loadValue: colorClearValue,\n                        storeOp: WebGPUConstants.StoreOp.Store,\n                    });\n                }\n            }\n            this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments, rtWrapper.textures!);\n        } else {\n            // single render target\n            const internalTexture = rtWrapper.texture!;\n            const gpuWrapper = internalTexture._hardwareTexture as WebGPUHardwareTexture;\n            const gpuTexture = gpuWrapper.underlyingResource!;\n\n            const gpuMSAATexture = gpuWrapper.msaaTexture;\n            const colorTextureView = gpuTexture.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor!);\n            const colorMSAATextureView = gpuMSAATexture?.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor!);\n\n            colorAttachments.push({\n                view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\n                resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\n                loadValue: colorClearValue,\n                storeOp: WebGPUConstants.StoreOp.Store,\n            });\n        }\n\n        this._debugPushGroup?.(\"render target pass\", 1);\n\n        this._rttRenderPassWrapper.renderPassDescriptor = {\n            colorAttachments,\n            depthStencilAttachment: depthStencilTexture && gpuDepthStencilTexture ? {\n                view: depthMSAATextureView ? depthMSAATextureView : depthTextureView!,\n                depthLoadValue: true /* depth always generated for the depth/stencil texture */ ? depthClearValue : WebGPUConstants.LoadOp.Load,\n                depthStoreOp: WebGPUConstants.StoreOp.Store,\n                stencilLoadValue: rtWrapper._depthStencilTextureWithStencil ? stencilClearValue : WebGPUConstants.LoadOp.Load,\n                stencilStoreOp: WebGPUConstants.StoreOp.Store,\n            } : undefined,\n            occlusionQuerySet: this._occlusionQuery?.hasQueries ? this._occlusionQuery.querySet : undefined,\n        };\n        this._rttRenderPassWrapper.renderPass = this._renderTargetEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor);\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                const internalTexture = rtWrapper.texture!;\n                console.log(\"frame #\" + (this as any)._count + \" - render target begin pass - internalTexture.uniqueId=\", internalTexture.uniqueId, \"width=\", internalTexture.width, \"height=\", internalTexture.height, this._rttRenderPassWrapper.renderPassDescriptor);\n            }\n        }\n\n        this._currentRenderPass = this._rttRenderPassWrapper.renderPass;\n\n        this._debugFlushPendingCommands?.();\n\n        this._resetCurrentViewport(1);\n        this._resetCurrentScissor(1);\n        this._resetCurrentStencilRef(1);\n        this._resetCurrentColorBlend(1);\n    }\n\n    /** @hidden */\n    public _endRenderTargetRenderPass() {\n        if (this._currentRenderPass) {\n            const gpuWrapper = this._currentRenderTarget!.texture!._hardwareTexture as WebGPUHardwareTexture;\n            if (!this._snapshotRendering.endRenderTargetPass(this._currentRenderPass, gpuWrapper) && !this.compatibilityMode) {\n                this._bundleListRenderTarget.run(this._currentRenderPass);\n                this._bundleListRenderTarget.reset();\n            }\n            this._currentRenderPass.endPass();\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if ((this as any)._count === undefined) { (this as any)._count = 0; }\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                    console.log(\"frame #\" + (this as any)._count + \" - render target end pass - internalTexture.uniqueId=\", this._currentRenderTarget?.texture?.uniqueId);\n                }\n            }\n            this._debugPopGroup?.(1);\n            this._resetCurrentViewport(1);\n            this._resetCurrentScissor(1);\n            this._resetCurrentStencilRef(1);\n            this._resetCurrentColorBlend(1);\n            this._currentRenderPass = null;\n            this._rttRenderPassWrapper.reset();\n        }\n    }\n\n    private _getCurrentRenderPass(): GPURenderPassEncoder {\n        if (this._currentRenderTarget && !this._currentRenderPass) {\n            // delayed creation of the render target pass, but we now need to create it as we are requested the render pass\n            this._startRenderTargetRenderPass(this._currentRenderTarget, false, null, false, false);\n        } else if (!this._currentRenderPass) {\n            this._startMainRenderPass(false);\n        }\n\n        return this._currentRenderPass!;\n    }\n\n    /** @hidden */\n    public _getCurrentRenderPassIndex(): number {\n        return this._currentRenderPass === null ? -1 : this._currentRenderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n    }\n\n    private _startMainRenderPass(setClearStates: boolean, clearColor?: Nullable<IColor4Like>, clearDepth?: boolean, clearStencil?: boolean): void {\n        if (this._mainRenderPassWrapper.renderPass) {\n            this._endMainRenderPass();\n        }\n\n        if (this.useReverseDepthBuffer) {\n            this.setDepthFunctionToGreaterOrEqual();\n        }\n\n        const colorClearValue = !setClearStates ? WebGPUConstants.LoadOp.Load : clearColor ? clearColor : WebGPUConstants.LoadOp.Load;\n        const depthClearValue = !setClearStates ? WebGPUConstants.LoadOp.Load : clearDepth ? (this.useReverseDepthBuffer ? this._clearReverseDepthValue : this._clearDepthValue) : WebGPUConstants.LoadOp.Load;\n        const stencilClearValue = !setClearStates ? WebGPUConstants.LoadOp.Load : clearStencil ? this._clearStencilValue : WebGPUConstants.LoadOp.Load;\n\n        this._mainRenderPassWrapper.renderPassDescriptor!.colorAttachments[0].loadValue = colorClearValue;\n        this._mainRenderPassWrapper.renderPassDescriptor!.depthStencilAttachment!.depthLoadValue = depthClearValue;\n        this._mainRenderPassWrapper.renderPassDescriptor!.depthStencilAttachment!.stencilLoadValue = stencilClearValue;\n        this._mainRenderPassWrapper.renderPassDescriptor!.occlusionQuerySet = this._occlusionQuery?.hasQueries ? this._occlusionQuery.querySet : undefined;\n\n        const renderPassWrapperForSwapChain = this._invertYFinalFramebuffer ? this._mainRenderPassCopyWrapper : this._mainRenderPassWrapper;\n\n        this._swapChainTexture = this._context.getCurrentTexture();\n        renderPassWrapperForSwapChain.colorAttachmentGPUTextures![0].set(this._swapChainTexture);\n\n        // Resolve in case of MSAA\n        if (this._options.antialiasing) {\n            if (this._invertYFinalFramebuffer) {\n                renderPassWrapperForSwapChain.renderPassDescriptor!.colorAttachments[0].view = this._swapChainTexture.createView();\n            } else {\n                renderPassWrapperForSwapChain.renderPassDescriptor!.colorAttachments[0].resolveTarget = this._swapChainTexture.createView();\n            }\n        }\n        else {\n            renderPassWrapperForSwapChain.renderPassDescriptor!.colorAttachments[0].view = this._swapChainTexture.createView();\n        }\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - main begin pass - texture width=\" + (this._mainTextureExtends as any).width, \" height=\" + (this._mainTextureExtends as any).height, this._mainRenderPassWrapper.renderPassDescriptor);\n            }\n        }\n\n        this._debugPushGroup?.(\"main pass\", 0);\n\n        this._currentRenderPass = this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor!);\n\n        this._mainRenderPassWrapper.renderPass = this._currentRenderPass;\n\n        this._debugFlushPendingCommands?.();\n\n        this._resetCurrentViewport(0);\n        this._resetCurrentScissor(0);\n        this._resetCurrentStencilRef(0);\n        this._resetCurrentColorBlend(0);\n    }\n\n    private _endMainRenderPass(): void {\n        if (this._mainRenderPassWrapper.renderPass !== null) {\n            this._snapshotRendering.endMainRenderPass();\n            if (!this.compatibilityMode && !this._snapshotRendering.play) {\n                this._bundleList.run(this._mainRenderPassWrapper.renderPass);\n                this._bundleList.reset();\n            }\n            this._mainRenderPassWrapper.renderPass.endPass();\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if ((this as any)._count === undefined) { (this as any)._count = 0; }\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                    console.log(\"frame #\" + (this as any)._count + \" - main end pass\");\n                }\n            }\n            this._debugPopGroup?.(0);\n            this._resetCurrentViewport(0);\n            this._resetCurrentScissor(0);\n            this._resetCurrentStencilRef(0);\n            this._resetCurrentColorBlend(0);\n            if (this._mainRenderPassWrapper.renderPass === this._currentRenderPass) {\n                this._currentRenderPass = null;\n            }\n            this._mainRenderPassWrapper.reset(false);\n        }\n    }\n\n    /**\n     * Binds the frame buffer to the specified texture.\n     * @param texture The render target wrapper to render to\n     * @param faceIndex The face of the texture to render to in case of cube texture\n     * @param requiredWidth The width of the target to render to\n     * @param requiredHeight The height of the target to render to\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\n     * @param lodLevel defines the lod level to bind to the frame buffer\n     * @param layer defines the 2d array index to bind to frame buffer to\n     */\n    public bindFramebuffer(texture: RenderTargetWrapper, faceIndex: number = 0, requiredWidth?: number, requiredHeight?: number, forceFullscreenViewport?: boolean, lodLevel = 0, layer = 0): void {\n        const hardwareTexture = texture.texture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\n\n        if (!hardwareTexture) {\n            if (this.dbgSanityChecks) {\n                console.error(\"bindFramebuffer: Trying to bind a texture that does not have a hardware texture!\", texture, hardwareTexture);\n            }\n            return;\n        }\n\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        this._currentRenderTarget = texture;\n        hardwareTexture._currentLayer = texture.isCube ? layer * 6 + faceIndex : layer;\n\n        this._rttRenderPassWrapper.colorAttachmentGPUTextures[0] = hardwareTexture;\n        this._rttRenderPassWrapper.depthTextureFormat = this._currentRenderTarget._depthStencilTexture ? WebGPUTextureHelper.GetWebGPUTextureFormat(-1, this._currentRenderTarget._depthStencilTexture.format) : undefined;\n\n        this._setDepthTextureFormat(this._rttRenderPassWrapper);\n        this._setColorFormat(this._rttRenderPassWrapper);\n\n        this._rttRenderPassWrapper.colorAttachmentViewDescriptor = {\n            format: this._colorFormat,\n            dimension: WebGPUConstants.TextureViewDimension.E2d,\n            mipLevelCount: 1,\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\n            baseMipLevel: lodLevel,\n            arrayLayerCount: 1,\n            aspect: WebGPUConstants.TextureAspect.All\n        };\n\n        this._rttRenderPassWrapper.depthAttachmentViewDescriptor = {\n            format: this._depthTextureFormat!,\n            dimension: WebGPUConstants.TextureViewDimension.E2d,\n            mipLevelCount: 1,\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\n            baseMipLevel: 0,\n            arrayLayerCount: 1,\n            aspect: WebGPUConstants.TextureAspect.All\n        };\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - bindFramebuffer called - internalTexture.uniqueId=\", texture.texture?.uniqueId, \"face=\", faceIndex, \"lodLevel=\", lodLevel, \"layer=\", layer, this._rttRenderPassWrapper.colorAttachmentViewDescriptor, this._rttRenderPassWrapper.depthAttachmentViewDescriptor);\n            }\n        }\n\n        this._currentRenderPass = null; // lazy creation of the render pass, hoping the render pass will be created by a call to clear()...\n\n        if (this.snapshotRendering && this.snapshotRenderingMode === 1) {\n            // force the creation of the render pass as we know in fast snapshot rendering mode clear() won't be called\n            this._getCurrentRenderPass();\n        }\n\n        if (this._cachedViewport && !forceFullscreenViewport) {\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\n        } else {\n            if (!requiredWidth) {\n                requiredWidth = texture.width;\n                if (lodLevel) {\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\n                }\n            }\n            if (!requiredHeight) {\n                requiredHeight = texture.height;\n                if (lodLevel) {\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\n                }\n            }\n\n            this._viewport(0, 0, requiredWidth, requiredHeight);\n        }\n\n        this.wipeCaches();\n    }\n\n    /**\n     * Unbind the current render target texture from the WebGPU context\n     * @param texture defines the render target wrapper to unbind\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\n     */\n    public unBindFramebuffer(texture: RenderTargetWrapper, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\n        const saveCRT = this._currentRenderTarget;\n\n        this._currentRenderTarget = null; // to be iso with thinEngine, this._currentRenderTarget must be null when onBeforeUnbind is called\n\n        if (onBeforeUnbind) {\n            onBeforeUnbind();\n        }\n\n        this._currentRenderTarget = saveCRT;\n\n        if (this._currentRenderPass && this._currentRenderPass !== this._mainRenderPassWrapper.renderPass) {\n            this._endRenderTargetRenderPass();\n        }\n\n        if (texture.texture?.generateMipMaps && !disableGenerateMipMaps && !texture.isCube) {\n            this._generateMipmaps(texture.texture);\n        }\n\n        this._currentRenderTarget = null;\n\n        this._onAfterUnbindFrameBufferObservable.notifyObservers(this);\n\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if ((this as any)._count === undefined) { (this as any)._count = 0; }\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + (this as any)._count + \" - unBindFramebuffer called - internalTexture.uniqueId=\", texture.texture?.uniqueId);\n            }\n        }\n\n        this._mrtAttachments = [];\n        this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments, []);\n        this._currentRenderPass = this._mainRenderPassWrapper.renderPass;\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\n        this._setColorFormat(this._mainRenderPassWrapper);\n    }\n\n    /**\n     * Unbind the current render target and bind the default framebuffer\n     */\n    public restoreDefaultFramebuffer(): void {\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        } else {\n            this._currentRenderPass = this._mainRenderPassWrapper.renderPass;\n            this._setDepthTextureFormat(this._mainRenderPassWrapper);\n            this._setColorFormat(this._mainRenderPassWrapper);\n        }\n        if (this._currentRenderPass) {\n            if (this._cachedViewport) {\n                this.setViewport(this._cachedViewport);\n            }\n        }\n\n        this.wipeCaches();\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Render\n    //------------------------------------------------------------------------------\n\n    /** @hidden */\n    public _setColorFormat(wrapper: WebGPURenderPassWrapper): void {\n        const format = wrapper.colorAttachmentGPUTextures[0].format;\n        this._cacheRenderPipeline.setColorFormat(format);\n        if (this._colorFormat === format) {\n            return;\n        }\n        this._colorFormat = format;\n    }\n\n    /** @hidden */\n    public _setDepthTextureFormat(wrapper: WebGPURenderPassWrapper): void {\n        this._cacheRenderPipeline.setDepthStencilFormat(wrapper.depthTextureFormat);\n        if (this._depthTextureFormat === wrapper.depthTextureFormat) {\n            return;\n        }\n        this._depthTextureFormat = wrapper.depthTextureFormat;\n    }\n\n    public setDitheringState(value: boolean): void {\n        // Does not exist in WebGPU\n    }\n\n    public setRasterizerState(value: boolean): void {\n        // Does not exist in WebGPU\n    }\n\n    /**\n     * Set various states to the webGL context\n     * @param culling defines culling state: true to enable culling, false to disable it\n     * @param zOffset defines the value to apply to zOffset (0 by default)\n     * @param force defines if states must be applied even if cache is up to date\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\n     * @param stencil stencil states to set\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\n     */\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false, cullBackFaces?: boolean, stencil?: IStencilState, zOffsetUnits: number = 0): void {\n        // Culling\n        if (this._depthCullingState.cull !== culling || force) {\n            this._depthCullingState.cull = culling;\n        }\n\n        // Cull face\n        var cullFace = (this.cullBackFaces ?? cullBackFaces ?? true) ? 1 : 2;\n        if (this._depthCullingState.cullFace !== cullFace || force) {\n            this._depthCullingState.cullFace = cullFace;\n        }\n\n        // Z offset\n        this.setZOffset(zOffset);\n        this.setZOffsetUnits(zOffsetUnits);\n\n        // Front face\n        // var frontFace = reverseSide ? this._gl.CW : this._gl.CCW;\n        var frontFace = reverseSide ? 1 : 2;\n        if (this._depthCullingState.frontFace !== frontFace || force) {\n            this._depthCullingState.frontFace = frontFace;\n        }\n\n        this._stencilStateComposer.stencilMaterial = stencil;\n    }\n\n    private _applyRenderPassChanges(renderPass: GPURenderPassEncoder, bundleList: Nullable<WebGPUBundleList>): void {\n        const mustUpdateViewport = this._mustUpdateViewport(renderPass);\n        const mustUpdateScissor = this._mustUpdateScissor(renderPass);\n        const mustUpdateStencilRef = !this._stencilStateComposer.enabled ? false : this._mustUpdateStencilRef(renderPass);\n        const mustUpdateBlendColor = !this._alphaState.alphaBlend ? false : this._mustUpdateBlendColor(renderPass);\n\n        if (bundleList) {\n            if (mustUpdateViewport) {\n                bundleList.addItem(new WebGPURenderItemViewport(this._viewportCached.x, this._viewportCached.y, this._viewportCached.z, this._viewportCached.w));\n            }\n            if (mustUpdateScissor) {\n                bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\n            }\n            if (mustUpdateStencilRef) {\n                bundleList.addItem(new WebGPURenderItemStencilRef(this._stencilStateComposer.funcRef ?? 0));\n            }\n            if (mustUpdateBlendColor) {\n                bundleList.addItem(new WebGPURenderItemBlendColor(this._alphaState._blendConstants.slice()));\n            }\n        } else {\n            if (mustUpdateViewport) {\n                this._applyViewport(renderPass as GPURenderPassEncoder);\n            }\n            if (mustUpdateScissor) {\n                this._applyScissor(renderPass as GPURenderPassEncoder);\n            }\n            if (mustUpdateStencilRef) {\n                this._applyStencilRef(renderPass as GPURenderPassEncoder);\n            }\n            if (mustUpdateBlendColor) {\n                this._applyBlendColor(renderPass as GPURenderPassEncoder);\n            }\n        }\n    }\n\n    private _draw(drawType: number, fillMode: number, start: number, count: number, instancesCount: number): void {\n        const renderPass = this._getCurrentRenderPass();\n        const renderPassIndex = this._getCurrentRenderPassIndex();\n        const bundleList = renderPassIndex === 0 ? this._bundleList : this._bundleListRenderTarget;\n\n        this.applyStates();\n\n        const webgpuPipelineContext = this._currentEffect!._pipelineContext as WebGPUPipelineContext;\n\n        if (webgpuPipelineContext.uniformBuffer) {\n            webgpuPipelineContext.uniformBuffer.update();\n            this.bindUniformBufferBase(webgpuPipelineContext.uniformBuffer.getBuffer()!, 0, WebGPUShaderProcessor.LeftOvertUBOName);\n        }\n\n        if (this._snapshotRendering.play) {\n            this._reportDrawCall();\n            return;\n        }\n\n        if (!this.compatibilityMode && (this._currentDrawContext.isDirty(this._currentMaterialContext.updateId) || this._currentMaterialContext.isDirty || this._currentMaterialContext.forceBindGroupCreation)) {\n            this._currentDrawContext.fastBundle = undefined;\n        }\n\n        const useFastPath = !this.compatibilityMode && this._currentDrawContext.fastBundle;\n        let renderPass2: GPURenderPassEncoder | GPURenderBundleEncoder = renderPass;\n\n        if (useFastPath || this._snapshotRendering.record) {\n            this._applyRenderPassChanges(renderPass, bundleList);\n            if (!this._snapshotRendering.record) {\n                this._counters.numBundleReuseNonCompatMode++;\n                if (this._currentDrawContext.indirectDrawBuffer) {\n                    this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\n                }\n                bundleList.addBundle(this._currentDrawContext.fastBundle);\n                this._reportDrawCall();\n                return;\n            }\n\n            renderPass2 = bundleList.getBundleEncoder(this._cacheRenderPipeline.colorFormats, this._depthTextureFormat, this.currentSampleCount); // for snapshot recording mode\n            bundleList.numDrawCalls++;\n        }\n\n        let textureState = 0;\n        if (!this._caps.textureFloatLinearFiltering && this._currentMaterialContext.hasFloatTextures) {\n            let bitVal = 1;\n            for (let i = 0; i < webgpuPipelineContext.shaderProcessingContext.textureNames.length; ++i) {\n                const textureName = webgpuPipelineContext.shaderProcessingContext.textureNames[i];\n                const texture = this._currentMaterialContext.textures[textureName]?.texture;\n                if (texture?.type === 1) {\n                    textureState |= bitVal;\n                }\n                bitVal = bitVal << 1;\n            }\n        }\n\n        const pipeline = this._cacheRenderPipeline.getRenderPipeline(fillMode, this._currentEffect!, this.currentSampleCount, textureState);\n        const bindGroups = this._cacheBindGroups.getBindGroups(webgpuPipelineContext, this._currentDrawContext, this._currentMaterialContext);\n\n        if (!this._snapshotRendering.record) {\n            this._applyRenderPassChanges(renderPass, !this.compatibilityMode ? bundleList : null);\n            if (!this.compatibilityMode) {\n                this._counters.numBundleCreationNonCompatMode++;\n                renderPass2 = this._device.createRenderBundleEncoder({\n                    colorFormats: this._cacheRenderPipeline.colorFormats,\n                    depthStencilFormat: this._depthTextureFormat,\n                    sampleCount: this.currentSampleCount,\n                });\n            }\n        }\n\n        // bind pipeline\n        renderPass2.setPipeline(pipeline);\n\n        // bind index/vertex buffers\n        if (this._currentIndexBuffer) {\n            renderPass2.setIndexBuffer(this._currentIndexBuffer.underlyingResource, this._currentIndexBuffer!.is32Bits ? WebGPUConstants.IndexFormat.Uint32 : WebGPUConstants.IndexFormat.Uint16, 0);\n        }\n\n        const vertexBuffers = this._cacheRenderPipeline.vertexBuffers;\n        for (var index = 0; index < vertexBuffers.length; index++) {\n            let vertexBuffer = vertexBuffers[index];\n\n            const buffer = vertexBuffer.getBuffer();\n            if (buffer) {\n                renderPass2.setVertexBuffer(index, buffer.underlyingResource, vertexBuffer._validOffsetRange ? 0 : vertexBuffer.byteOffset);\n            }\n        }\n\n        // bind bind groups\n        for (let i = 0; i < bindGroups.length; i++) {\n            renderPass2.setBindGroup(i, bindGroups[i]);\n        }\n\n        // draw\n        const nonCompatMode = !this.compatibilityMode && !this._snapshotRendering.record;\n\n        if (nonCompatMode && this._currentDrawContext.indirectDrawBuffer) {\n            this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\n            if (drawType === 0) {\n                renderPass2.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\n            } else {\n                renderPass2.drawIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\n            }\n        } else if (drawType === 0) {\n            renderPass2.drawIndexed(count, instancesCount || 1, start, 0, 0);\n        } else {\n            renderPass2.draw(count, instancesCount || 1, start, 0);\n        }\n\n        if (nonCompatMode) {\n            this._currentDrawContext.fastBundle = (renderPass2 as GPURenderBundleEncoder).finish();\n            bundleList.addBundle(this._currentDrawContext.fastBundle);\n        }\n\n        this._reportDrawCall();\n    }\n\n    /**\n     * Draw a list of indexed primitives\n     * @param fillMode defines the primitive to use\n     * @param indexStart defines the starting index\n     * @param indexCount defines the number of index to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount: number = 1): void {\n        this._draw(0, fillMode, indexStart, indexCount, instancesCount);\n    }\n\n    /**\n     * Draw a list of unindexed primitives\n     * @param fillMode defines the primitive to use\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount: number = 1): void {\n        this._currentIndexBuffer = null;\n        this._draw(1, fillMode, verticesStart, verticesCount, instancesCount);\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Dispose\n    //------------------------------------------------------------------------------\n\n    /**\n     * Dispose and release all associated resources\n     */\n    public dispose(): void {\n        this._mainTexture?.destroy();\n        this._mainTextureLastCopy?.destroy();\n        this._depthTexture?.destroy();\n        super.dispose();\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Misc\n    //------------------------------------------------------------------------------\n\n    /**\n     * Gets the current render width\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render width\n     */\n    public getRenderWidth(useScreen = false): number {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.width;\n        }\n\n        return this._canvas.width;\n    }\n\n    /**\n     * Gets the current render height\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render height\n     */\n    public getRenderHeight(useScreen = false): number {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.height;\n        }\n\n        return this._canvas.height;\n    }\n\n    /**\n     * Gets the HTML canvas attached with the current WebGPU context\n     * @returns a HTML canvas\n     */\n    public getRenderingCanvas(): Nullable<HTMLCanvasElement> {\n        return this._canvas;\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Errors\n    //------------------------------------------------------------------------------\n\n    /**\n     * Get the current error code of the WebGPU context\n     * @returns the error code\n     */\n    public getError(): number {\n        // TODO WEBGPU. from the webgpu errors.\n        return 0;\n    }\n\n    //------------------------------------------------------------------------------\n    //                              Unused WebGPU\n    //------------------------------------------------------------------------------\n\n    /** @hidden */\n    public bindSamplers(effect: Effect): void { }\n\n    /** @hidden */\n    public _bindTextureDirectly(target: number, texture: InternalTexture, forTextureDataUpdate = false, force = false): boolean {\n        return false;\n    }\n\n    /**\n     * Gets a boolean indicating if all created effects are ready\n     * @returns always true - No parallel shader compilation\n     */\n    public areAllEffectsReady(): boolean {\n        return true;\n    }\n\n    /** @hidden */\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\n        // No parallel shader compilation.\n        // No Async, so direct launch\n        action();\n    }\n\n    /** @hidden */\n    public _isRenderingStateCompiled(pipelineContext: IPipelineContext): boolean {\n        // No parallel shader compilation.\n        return true;\n    }\n\n    /** @hidden */\n    public _getUnpackAlignement(): number {\n        return 1;\n    }\n\n    /** @hidden */\n    public _unpackFlipY(value: boolean) { }\n\n    /** @hidden */\n    public _bindUnboundFramebuffer(framebuffer: Nullable<WebGLFramebuffer>) {\n        throw \"_bindUnboundFramebuffer is not implementedin WebGPU! You probably want to use restoreDefaultFramebuffer or unBindFramebuffer instead\";\n    }\n\n    // TODO WEBGPU. All of the below should go once engine split with baseEngine.\n\n    /** @hidden */\n    public _getSamplingParameters(samplingMode: number, generateMipMaps: boolean): { min: number; mag: number } {\n        throw \"_getSamplingParameters is not available in WebGPU\";\n    }\n\n    /** @hidden */\n    public getUniforms(pipelineContext: IPipelineContext, uniformsNames: string[]): Nullable<WebGLUniformLocation>[] {\n        return [];\n    }\n\n    /** @hidden */\n    public setIntArray(uniform: WebGLUniformLocation, array: Int32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setIntArray2(uniform: WebGLUniformLocation, array: Int32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setIntArray3(uniform: WebGLUniformLocation, array: Int32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setIntArray4(uniform: WebGLUniformLocation, array: Int32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setArray(uniform: WebGLUniformLocation, array: number[]): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setArray2(uniform: WebGLUniformLocation, array: number[]): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setArray3(uniform: WebGLUniformLocation, array: number[]): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setArray4(uniform: WebGLUniformLocation, array: number[]): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setMatrices(uniform: WebGLUniformLocation, matrices: Float32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setMatrix3x3(uniform: WebGLUniformLocation, matrix: Float32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setMatrix2x2(uniform: WebGLUniformLocation, matrix: Float32Array): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setFloat(uniform: WebGLUniformLocation, value: number): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setFloat2(uniform: WebGLUniformLocation, x: number, y: number): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setFloat3(uniform: WebGLUniformLocation, x: number, y: number, z: number): boolean {\n        return false;\n    }\n\n    /** @hidden */\n    public setFloat4(uniform: WebGLUniformLocation, x: number, y: number, z: number, w: number): boolean {\n        return false;\n    }\n}\n"]}
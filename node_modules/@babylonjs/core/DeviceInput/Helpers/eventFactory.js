import { EventConstants } from "../../Events/deviceInputEvents.js";
import { DeviceType, PointerInput } from "../InputDevices/deviceEnums.js";
/**
 * Class to wrap DeviceInputSystem data into an event object
 */
var DeviceEventFactory = /** @class */ (function () {
    function DeviceEventFactory() {
    }
    /**
     * Create device input events based on provided type and slot
     *
     * @param deviceType Type of device
     * @param deviceSlot "Slot" or index that device is referenced in
     * @param inputIndex Id of input to be checked
     * @param currentState Current value for given input
     * @param deviceInputSystem Reference to DeviceInputSystem
     * @param elementToAttachTo HTMLElement to reference as target for inputs
     * @returns IEvent object
     */
    DeviceEventFactory.CreateDeviceEvent = function (deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo) {
        switch (deviceType) {
            case DeviceType.Keyboard:
                return this._createKeyboardEvent(inputIndex, currentState, deviceInputSystem, elementToAttachTo);
            case DeviceType.Mouse:
                if (inputIndex === PointerInput.MouseWheelX || inputIndex === PointerInput.MouseWheelY || inputIndex === PointerInput.MouseWheelZ) {
                    return this._createWheelEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);
                }
            case DeviceType.Touch:
                return this._createPointerEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);
            default:
                throw "Unable to generate event for device " + DeviceType[deviceType];
        }
    };
    /**
     * Creates pointer event
     *
     * @param deviceType Type of device
     * @param deviceSlot "Slot" or index that device is referenced in
     * @param inputIndex Id of input to be checked
     * @param currentState Current value for given input
     * @param deviceInputSystem Reference to DeviceInputSystem
     * @param elementToAttachTo HTMLElement to reference as target for inputs
     * @returns IEvent object (Pointer)
     */
    DeviceEventFactory._createPointerEvent = function (deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo) {
        var evt = this._createMouseEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);
        evt.pointerId = deviceType === DeviceType.Mouse ? 1 : deviceSlot;
        if (inputIndex === PointerInput.Horizontal ||
            inputIndex === PointerInput.Vertical ||
            inputIndex === PointerInput.DeltaHorizontal ||
            inputIndex === PointerInput.DeltaVertical) {
            evt.type = "pointermove";
        }
        else if (inputIndex >= PointerInput.LeftClick && inputIndex <= PointerInput.RightClick) {
            evt.type = (currentState === 1) ? "pointerdown" : "pointerup";
            evt.button = inputIndex - 2;
        }
        return evt;
    };
    /**
     * Create Mouse Wheel Event
     * @param deviceType Type of device
     * @param deviceSlot "Slot" or index that device is referenced in
     * @param inputIndex Id of input to be checked
     * @param currentState Current value for given input
     * @param deviceInputSystem Reference to DeviceInputSystem
     * @param elementToAttachTo HTMLElement to reference as target for inputs
     * @returns IEvent object (Wheel)
     */
    DeviceEventFactory._createWheelEvent = function (deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo) {
        var evt = this._createMouseEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);
        evt.type = "wheel";
        evt.deltaMode = EventConstants.DOM_DELTA_PIXEL;
        evt.deltaX = (inputIndex === PointerInput.MouseWheelX) ? currentState : deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.MouseWheelX);
        evt.deltaY = (inputIndex === PointerInput.MouseWheelY) ? currentState : deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.MouseWheelY);
        evt.deltaZ = (inputIndex === PointerInput.MouseWheelZ) ? currentState : deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.MouseWheelZ);
        return evt;
    };
    /**
     * Create Mouse Event
     * @param deviceType Type of device
     * @param deviceSlot "Slot" or index that device is referenced in
     * @param inputIndex Id of input to be checked
     * @param currentState Current value for given input
     * @param deviceInputSystem Reference to DeviceInputSystem
     * @param elementToAttachTo HTMLElement to reference as target for inputs
     * @returns IEvent object (Mouse)
     */
    DeviceEventFactory._createMouseEvent = function (deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo) {
        var evt = this._createEvent(elementToAttachTo);
        var pointerX = deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.Horizontal);
        var pointerY = deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.Vertical);
        // If dealing with a change to the delta, grab values for event init
        var movementX = inputIndex === PointerInput.DeltaHorizontal ? currentState : 0;
        var movementY = inputIndex === PointerInput.DeltaVertical ? currentState : 0;
        // Get offsets from container
        var offsetX = inputIndex === PointerInput.DeltaHorizontal && elementToAttachTo ? movementX - elementToAttachTo.getBoundingClientRect().x : 0;
        var offsetY = inputIndex === PointerInput.DeltaVertical && elementToAttachTo ? movementY - elementToAttachTo.getBoundingClientRect().y : 0;
        this._checkNonCharacterKeys(evt, deviceInputSystem);
        evt.clientX = pointerX;
        evt.clientY = pointerY;
        evt.movementX = movementX;
        evt.movementY = movementY;
        evt.offsetX = offsetX;
        evt.offsetY = offsetY;
        evt.x = pointerX;
        evt.y = pointerY;
        return evt;
    };
    /**
     * Create Keyboard Event
     * @param inputIndex Id of input to be checked
     * @param currentState Current value for given input
     * @param deviceInputSystem Reference to DeviceInputSystem
     * @param elementToAttachTo HTMLElement to reference as target for inputs
     * @returns IEvent object (Keyboard)
     */
    DeviceEventFactory._createKeyboardEvent = function (inputIndex, currentState, deviceInputSystem, elementToAttachTo) {
        var evt = this._createEvent(elementToAttachTo);
        this._checkNonCharacterKeys(evt, deviceInputSystem);
        evt.type = currentState === 1 ? "keydown" : "keyup";
        evt.key = String.fromCharCode(inputIndex);
        evt.keyCode = inputIndex;
        return evt;
    };
    /**
     * Add parameters for non-character keys (Ctrl, Alt, Meta, Shift)
     * @param evt Event object to add parameters to
     * @param deviceInputSystem DeviceInputSystem to pull values from
     */
    DeviceEventFactory._checkNonCharacterKeys = function (evt, deviceInputSystem) {
        var isKeyboardActive = deviceInputSystem.isDeviceAvailable(DeviceType.Keyboard);
        var altKey = isKeyboardActive && deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 18) === 1;
        var ctrlKey = isKeyboardActive && deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 17) === 1;
        var metaKey = isKeyboardActive &&
            (deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 91) === 1 ||
                deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 92) === 1 ||
                deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 93) === 1);
        var shiftKey = isKeyboardActive && deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 16) === 1;
        evt.altKey = altKey;
        evt.ctrlKey = ctrlKey;
        evt.metaKey = metaKey;
        evt.shiftKey = shiftKey;
    };
    /**
     * Create base event object
     * @param elementToAttachTo Value to use as event target
     * @returns
     */
    DeviceEventFactory._createEvent = function (elementToAttachTo) {
        var evt = {};
        evt.preventDefault = function () { };
        evt.target = elementToAttachTo;
        return evt;
    };
    return DeviceEventFactory;
}());
export { DeviceEventFactory };
//# sourceMappingURL=eventFactory.js.map